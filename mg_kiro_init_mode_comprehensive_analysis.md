# mg_kiro MCP Server - Init Mode å®Œæ•´åˆ†ææ–‡æ¡£

## ğŸ“‹ æ¦‚è¿°

mg_kiro MCP Server æ˜¯ä¸€ä¸ªä¸“ä¸º Claude Code è®¾è®¡çš„ MCP (Model Context Protocol) æœåŠ¡å™¨ï¼Œæä¾›é¡¹ç›®åˆå§‹åŒ–å’Œæ–‡æ¡£ç”ŸæˆåŠŸèƒ½ã€‚Init Mode æ˜¯å…¶æ ¸å¿ƒå·¥ä½œæ¨¡å¼ï¼Œé€šè¿‡ 6 æ­¥å®Œæ•´æµç¨‹ä¸ºé¡¹ç›®ç”Ÿæˆè¯¦ç»†çš„æ–‡æ¡£ä½“ç³»ã€‚

**ç‰ˆæœ¬**: v4.0.0-complete-6-steps  
**åè®®**: MCP 2024-11-05  
**ä¸»è¦åŠŸèƒ½**: é¡¹ç›®æ¦‚è§ˆç”Ÿæˆã€æ¸è¿›å¼æ–‡æ¡£ç”Ÿæˆã€è¯­è¨€æ™ºèƒ½è¯†åˆ«  

## ğŸ¯ Init Mode å·¥ä½œæµç¨‹è¯¦è§£

### 6 æ­¥å®Œæ•´æµç¨‹æ¦‚è§ˆ

Init Mode é‡‡ç”¨æ™ºèƒ½åŒ–çš„ 6 æ­¥æµç¨‹ï¼Œä»é¡¹ç›®åˆ†æåˆ°æœ€ç»ˆæ¶æ„æ–‡æ¡£ç”Ÿæˆï¼š

```mermaid
graph TD
    A[Step 1: é¡¹ç›®åˆ†æ] --> B[Step 2: åˆ›å»ºAIä»»åŠ¡åˆ—è¡¨]
    B --> C[Step 3: æ–‡ä»¶æ–‡æ¡£ç”Ÿæˆ - å¾ªç¯]
    C --> D[Step 4: æ¨¡å—æ•´åˆ]
    D --> E[Step 5: æ¨¡å—å…³è”åˆ†æ]
    E --> F[Step 6: æ¶æ„æ–‡æ¡£ç”Ÿæˆ]
    
    C1[è·å–ä¸‹ä¸€ä¸ªä»»åŠ¡] --> C2[è·å–æ–‡ä»¶å†…å®¹]
    C2 --> C3[AIç”Ÿæˆåˆ†æ]
    C3 --> C4[å®Œæˆä»»åŠ¡]
    C4 --> C1
    
    C --> C1
```

### Step 1: é¡¹ç›®åˆ†æ (Project Analysis)

**å·¥å…·**: `init_step1_project_analysis`  
**èŒè´£**: æ·±åº¦åˆ†æé¡¹ç›®ç»“æ„ï¼Œç”ŸæˆåŸºç¡€æ•°æ®åŒ…

#### æ ¸å¿ƒåŠŸèƒ½
- **è¯­è¨€æ£€æµ‹**: è‡ªåŠ¨è¯†åˆ«é¡¹ç›®ä¸»è¦ç¼–ç¨‹è¯­è¨€
- **ä¾èµ–åˆ†æ**: æå– package.jsonã€requirements.txt ç­‰é…ç½®æ–‡ä»¶ä¿¡æ¯
- **ç›®å½•ç»“æ„**: ç”Ÿæˆå®Œæ•´çš„é¡¹ç›®ç›®å½•æ ‘ï¼ˆæ”¯æŒ maxDepth æ§åˆ¶ï¼‰
- **å…³é”®æ–‡ä»¶**: æ™ºèƒ½æå–é‡è¦é…ç½®æ–‡ä»¶å’Œå…¥å£æ–‡ä»¶å†…å®¹
- **æ¶æ„ç‰¹å¾**: åˆ†æé¡¹ç›®å¤æ‚åº¦ã€æ¶æ„ç±»å‹ã€æ¡†æ¶ç‰¹å¾

#### è¾“å…¥å‚æ•°
```json
{
  "projectPath": "string (å¿…éœ€) - é¡¹ç›®æ ¹ç›®å½•ç»å¯¹è·¯å¾„",
  "maxDepth": "number (å¯é€‰, é»˜è®¤3) - ç›®å½•æ‰«ææ·±åº¦",
  "includeFiles": "array (å¯é€‰) - é¢å¤–åŒ…å«çš„æ–‡ä»¶æ¨¡å¼",
  "maxKeyFileSize": "number (å¯é€‰, é»˜è®¤50KB) - å…³é”®æ–‡ä»¶æœ€å¤§å­—èŠ‚æ•°"
}
```

#### è¾“å‡ºç»“æœ
- **projectMetadata**: é¡¹ç›®å…ƒæ•°æ®ï¼ˆåç§°ã€æ€»æ–‡ä»¶æ•°ã€å¤§å°ç­‰ï¼‰
- **languageProfile**: è¯­è¨€é…ç½®æ–‡ä»¶ï¼ˆä¸»è¦è¯­è¨€ã€æ¡†æ¶ã€ä¾èµ–ï¼‰
- **dependencyAnalysis**: ä¾èµ–å…³ç³»åˆ†æ
- **directoryStructure**: ç›®å½•ç»“æ„æ ‘
- **keyFileContents**: å…³é”®æ–‡ä»¶å†…å®¹
- **projectCharacteristics**: é¡¹ç›®ç‰¹å¾ï¼ˆæ¶æ„ç±»å‹ã€å¤æ‚åº¦ï¼‰
- **aiGenerationGuide**: AI ç”ŸæˆæŒ‡å¯¼ï¼ˆæ‰¹æ¬¡å¤§å°å»ºè®®ã€æ–‡æ¡£ç­–ç•¥ï¼‰

### Step 2: åˆ›å»ºAIä»»åŠ¡åˆ—è¡¨ (Create Todos)

**å·¥å…·**: `init_step2_create_todos`  
**èŒè´£**: åŸºäºé¡¹ç›®åˆ†æç»“æœåˆ›å»ºè¯¦ç»†çš„å¤„ç†ä»»åŠ¡åˆ—è¡¨

#### æ ¸å¿ƒåŠŸèƒ½
- **ä»»åŠ¡åˆ†è§£**: å°†é¡¹ç›®æ–‡ä»¶åˆ†è§£ä¸ºå¯å¤„ç†çš„ä»»åŠ¡å•å…ƒ
- **æ‰¹æ¬¡è§„åˆ’**: æ™ºèƒ½æ‰¹æ¬¡å¤§å°è®¡ç®—ï¼Œä¼˜åŒ– token ä½¿ç”¨
- **ä¼˜å…ˆçº§æ’åº**: æŒ‰æ–‡ä»¶é‡è¦æ€§å’Œä¾èµ–å…³ç³»æ’åº
- **å¤„ç†ç­–ç•¥**: ç”Ÿæˆæ–‡ä»¶å¤„ç†ç­–ç•¥å’Œæ—¶é—´ä¼°ç®—

#### è¾“å…¥å‚æ•°
```json
{
  "projectPath": "string (å¿…éœ€) - é¡¹ç›®æ ¹ç›®å½•è·¯å¾„",
  "batchSize": "number (å¯é€‰) - æ‰¹æ¬¡å¤§å°ï¼Œé»˜è®¤ä½¿ç”¨Step1å»ºè®®å€¼",
  "includeAnalysisTasks": "boolean (å¯é€‰, é»˜è®¤true) - æ˜¯å¦åŒ…å«åˆ†æä»»åŠ¡",
  "includeSummaryTasks": "boolean (å¯é€‰, é»˜è®¤true) - æ˜¯å¦åŒ…å«æ€»ç»“ä»»åŠ¡"
}
```

#### è¾“å‡ºç»“æœ
- **todoCreationResults**: ä»»åŠ¡åˆ›å»ºç»“æœç»Ÿè®¡
- **processingStrategy**: å¤„ç†ç­–ç•¥ï¼ˆæ‰¹æ¬¡æ•°ã€å¹³å‡å¤§å°ã€å¤„ç†æ¨¡å¼ï¼‰
- **estimatedTime**: é¢„ä¼°å¤„ç†æ—¶é—´
- **nextStep**: ä¸‹ä¸€æ­¥æŒ‡å¯¼ä¿¡æ¯

### Step 3: æ–‡ä»¶æ–‡æ¡£ç”Ÿæˆ (File Processing Loop)

**æ ¸å¿ƒå·¥å…·é“¾**: 
- `init_step3_get_next_task` â†’ `init_step3_get_file_content` â†’ `init_step3_generate_analysis` â†’ `init_step3_complete_task`

#### 3.1 è·å–ä¸‹ä¸€ä¸ªä»»åŠ¡ (`init_step3_get_next_task`)

**èŒè´£**: å¯åŠ¨æ–‡ä»¶å¤„ç†æµç¨‹ï¼Œè·å–ç¬¬ä¸€ä¸ª/ä¸‹ä¸€ä¸ªå¾…å¤„ç†ä»»åŠ¡

```json
{
  "projectPath": "string (å¿…éœ€) - é¡¹ç›®æ ¹ç›®å½•è·¯å¾„"
}
```

**è¿”å›**: ä¸‹ä¸€ä¸ªä»»åŠ¡ä¿¡æ¯ï¼ˆä»»åŠ¡IDã€æ–‡ä»¶è·¯å¾„ã€å¤„ç†æŒ‡å¯¼ï¼‰

#### 3.2 è·å–æ–‡ä»¶å†…å®¹ (`init_step3_get_file_content`)

**èŒè´£**: è¯»å–å½“å‰ä»»åŠ¡çš„æ–‡ä»¶å†…å®¹ï¼Œè¿›è¡Œæ™ºèƒ½åˆ†ç‰‡å¤„ç†

```json
{
  "projectPath": "string (å¿…éœ€) - é¡¹ç›®æ ¹ç›®å½•è·¯å¾„",
  "relativePath": "string (å¿…éœ€) - æ–‡ä»¶ç›¸å¯¹è·¯å¾„ï¼ˆä»next_taskè·å–ï¼‰",
  "maxContentLength": "number (å¯é€‰, é»˜è®¤50000) - æ–‡ä»¶å†…å®¹æœ€å¤§é•¿åº¦"
}
```

**æ ¸å¿ƒåŠŸèƒ½**:
- **æ™ºèƒ½åˆ†ç‰‡**: è¶…å¤§æ–‡ä»¶è‡ªåŠ¨åˆ†ç‰‡ï¼Œæ¯ç‰‡æ§åˆ¶åœ¨ 1500 token ä»¥å†…
- **Token è®¡ç®—**: ç²¾ç¡®çš„ token ä¼°ç®—ï¼ˆæ”¯æŒä¸­è‹±æ–‡æ··åˆï¼‰
- **å†…å®¹é¢„å¤„ç†**: å»é™¤å†—ä½™ç©ºç™½ï¼Œä¿æŒä»£ç ç»“æ„

#### 3.3 ç”Ÿæˆåˆ†ææ–‡æ¡£ (`init_step3_generate_analysis`)

**èŒè´£**: åŸºäºæ–‡ä»¶å†…å®¹ç”Ÿæˆåˆ†ææ–‡æ¡£ï¼Œè§£å†³ AI ä¸çŸ¥é“ç”Ÿæˆä»€ä¹ˆçš„é—®é¢˜

```json
{
  "projectPath": "string (å¿…éœ€) - é¡¹ç›®æ ¹ç›®å½•è·¯å¾„",
  "taskId": "string (å¯é€‰) - ä»»åŠ¡IDï¼ˆè‡ªåŠ¨è·å–ï¼‰",
  "analysisContent": "string (å¯é€‰) - AIç”Ÿæˆçš„åˆ†æå†…å®¹",
  "analysisStyle": "string (å¯é€‰) - åˆ†æé£æ ¼ comprehensive|concise|technical",
  "includeCodeExamples": "boolean (å¯é€‰, é»˜è®¤true) - æ˜¯å¦åŒ…å«ä»£ç ç¤ºä¾‹"
}
```

**æ™ºèƒ½ç‰¹æ€§**:
- **ä¸Šä¸‹æ–‡ç®¡ç†**: è‡ªåŠ¨ç»´æŠ¤ä»»åŠ¡ä¸Šä¸‹æ–‡ï¼Œé¿å…è°ƒç”¨æ–­æ¡£
- **æ¨¡æ¿é©±åŠ¨**: ä½¿ç”¨é¢„å®šä¹‰æ¨¡æ¿å¼•å¯¼ AI ç”Ÿæˆ
- **è´¨é‡æ§åˆ¶**: å†…ç½®è´¨é‡æ£€æŸ¥å’Œæ ¼å¼æ ‡å‡†

#### 3.4 å®Œæˆä»»åŠ¡ (`init_step3_complete_task`)

**èŒè´£**: ä¿å­˜ç”Ÿæˆçš„æ–‡æ¡£ï¼Œæ›´æ–°è¿›åº¦ï¼Œè·å–ä¸‹ä¸€ä¸ªä»»åŠ¡

```json
{
  "projectPath": "string (å¿…éœ€) - é¡¹ç›®æ ¹ç›®å½•è·¯å¾„",
  "taskId": "string (å¿…éœ€) - ä»»åŠ¡ID",
  "step": "string (å¯é€‰) - æ­¥éª¤ç±»å‹ file-processing|module-integration|overview-generation",
  "notes": "string (å¯é€‰) - å®Œæˆå¤‡æ³¨"
}
```

**æ ¸å¿ƒåŠŸèƒ½**:
- **æ–‡æ¡£ä¿å­˜**: å°†åˆ†ææ–‡æ¡£ä¿å­˜åˆ° `mg_kiro/files/` ç›®å½•
- **è¿›åº¦æ›´æ–°**: æ›´æ–°ä»»åŠ¡å®ŒæˆçŠ¶æ€å’Œå…¨å±€è¿›åº¦
- **å¾ªç¯æ§åˆ¶**: åˆ¤æ–­æ˜¯å¦æœ‰æ›´å¤šæ–‡ä»¶éœ€è¦å¤„ç†

### Step 4: æ¨¡å—æ•´åˆ (Module Integration)

**å·¥å…·**: `init_step4_module_integration`  
**èŒè´£**: å°†æ–‡ä»¶çº§æ–‡æ¡£æ•´åˆä¸ºæ¨¡å—çº§æ¶æ„

#### æ ¸å¿ƒåŠŸèƒ½
- **æ¨¡å—è¯†åˆ«**: åŸºäºç›®å½•ç»“æ„å’Œæ–‡ä»¶å…³ç³»è¯†åˆ«æ¨¡å—
- **åŠŸèƒ½èšåˆ**: å°†ç›¸å…³æ–‡ä»¶çš„åŠŸèƒ½èšåˆä¸ºæ¨¡å—åŠŸèƒ½
- **æ¥å£æå–**: æå–æ¨¡å—å¯¹å¤–æ¥å£å’Œå†…éƒ¨å®ç°
- **ä¾èµ–æ¢³ç†**: åˆ†ææ¨¡å—é—´çš„ä¾èµ–å…³ç³»

#### è¾“å‡ºæ–‡æ¡£
- **æ¨¡å—æ•´åˆæŒ‡å¯¼**: æä¾›æ¨¡å—æ•´åˆçš„è¯¦ç»†æŒ‡å¯¼
- **æ¨¡å—æ€»è§ˆ**: ç”Ÿæˆæ¯ä¸ªæ¨¡å—çš„åŠŸèƒ½æ€»è§ˆ
- **æ¶æ„å»ºè®®**: æä¾›æ¶æ„ä¼˜åŒ–å»ºè®®

### Step 5: æ¨¡å—å…³è”åˆ†æ (Module Relations)

**å·¥å…·**: `init_step5_module_relations`  
**èŒè´£**: è¯¦ç»†åˆ†ææ¨¡å—é—´çš„å…³è”å…³ç³»

#### åˆ†æç»´åº¦
- **å‡½æ•°è°ƒç”¨å…³ç³»**: è·¨æ¨¡å—å‡½æ•°è°ƒç”¨é¢‘æ¬¡å’Œè·¯å¾„
- **æ•°æ®ä¾èµ–å…³ç³»**: æ•°æ®åœ¨æ¨¡å—é—´çš„æµè½¬è·¯å¾„
- **æ¨¡å—é—´ä¾èµ–**: æ¨¡å—å±‚é¢çš„ä¾èµ–å…³ç³»å›¾
- **æ¥å£å’ŒæœåŠ¡è°ƒç”¨**: API å’ŒæœåŠ¡å±‚çš„è°ƒç”¨å…³ç³»

#### è¾“å‡ºç»“æœ
- **ä¾èµ–å…³ç³»å›¾**: å¯è§†åŒ–çš„æ¨¡å—ä¾èµ–å…³ç³»
- **è°ƒç”¨é¢‘æ¬¡åˆ†æ**: é«˜é¢‘è°ƒç”¨çš„å‡½æ•°å’Œæ¥å£
- **æ•°æ®æµå‘å›¾**: ç³»ç»Ÿæ•°æ®æµå‘åˆ†æ
- **æ¶æ„æ´å¯Ÿ**: æ¶æ„è®¾è®¡çš„æ·±åº¦æ´å¯Ÿ

### Step 6: æ¶æ„æ–‡æ¡£ç”Ÿæˆ (Architecture Docs)

**å·¥å…·**: `init_step6_architecture_docs`  
**èŒè´£**: ç”Ÿæˆæœ€ç»ˆçš„æ¶æ„æ–‡æ¡£å’Œé¡¹ç›®æ€»è§ˆ

#### ç”Ÿæˆæ–‡æ¡£
- **README.md**: é¡¹ç›®ä¸»è¦è¯´æ˜æ–‡æ¡£
- **architecture.md**: è¯¦ç»†çš„æ¶æ„è®¾è®¡æ–‡æ¡£
- **development.md**: å¼€å‘æŒ‡å—å’Œæœ€ä½³å®è·µ
- **docs-index.md**: å®Œæ•´çš„æ–‡æ¡£ç´¢å¼•

#### æ–‡æ¡£å†…å®¹
- **é¡¹ç›®æ¦‚è¿°**: é¡¹ç›®ç›®æ ‡ã€ç‰¹æ€§ã€æŠ€æœ¯æ ˆ
- **æ¶æ„è®¾è®¡**: ç³»ç»Ÿæ¶æ„ã€æ¨¡å—è®¾è®¡ã€æ•°æ®æµ
- **å¼€å‘æŒ‡å—**: ç¯å¢ƒæ­å»ºã€å¼€å‘æµç¨‹ã€ä»£ç è§„èŒƒ
- **API æ–‡æ¡£**: æ¥å£è¯´æ˜ã€ä½¿ç”¨ç¤ºä¾‹ã€é›†æˆæŒ‡å—

## ğŸ”§ æ ¸å¿ƒæœåŠ¡æ¶æ„

### æœåŠ¡æ€»çº¿æ¶æ„ (ServiceBus)

mg_kiro é‡‡ç”¨æœåŠ¡æ€»çº¿æ¶æ„ï¼Œå®ç°æœåŠ¡çš„æ³¨å†Œã€ä¾èµ–æ³¨å…¥å’Œç”Ÿå‘½å‘¨æœŸç®¡ç†ï¼š

```javascript
// æœåŠ¡æ³¨å†Œç¤ºä¾‹
serviceBus
  .register('languageDetector', LanguageDetector, {}, [])
  .register('projectOverviewGenerator', ProjectOverviewGenerator, {}, [])
  .register('masterTemplateService', MasterTemplateService, {}, [
    'templateConfigManager', 'languageIntelligence'
  ]);
```

### æ ¸å¿ƒæœåŠ¡è¯¦è§£

#### 1. ProjectOverviewGenerator (é¡¹ç›®æ¦‚è§ˆç”Ÿæˆå™¨)

**ä½ç½®**: `server/services/project-overview-generator.js`  
**èŒè´£**: Step 1 çš„æ ¸å¿ƒå®ç°

**å…³é”®æ–¹æ³•**:
- `generateOverview()`: ç”Ÿæˆå®Œæ•´é¡¹ç›®æ¦‚è§ˆ
- `collectProjectMetadata()`: æ”¶é›†é¡¹ç›®å…ƒæ•°æ®
- `analyzeLanguageProfile()`: åˆ†æè¯­è¨€é…ç½®
- `analyzeDependencies()`: åˆ†æä¾èµ–å…³ç³»
- `analyzeDirectoryStructure()`: åˆ†æç›®å½•ç»“æ„

**æ™ºèƒ½ç‰¹æ€§**:
- **å¹¶è¡Œåˆ†æ**: 5 ä¸ªåˆ†æä»»åŠ¡å¹¶è¡Œæ‰§è¡Œ
- **æ™ºèƒ½æˆªå–**: å¤§æ–‡ä»¶æ™ºèƒ½æˆªå–å…³é”®å†…å®¹
- **è¯­è¨€è¯†åˆ«**: åŸºäºæ–‡ä»¶æ‰©å±•åå’Œé…ç½®çš„æ™ºèƒ½è¯­è¨€æ£€æµ‹

#### 2. AITodoManager (AI ä»»åŠ¡ç®¡ç†å™¨)

**ä½ç½®**: `server/services/ai-todo-manager.js`  
**èŒè´£**: Step 2 çš„æ ¸å¿ƒå®ç°ï¼Œç®¡ç† AI å¤„ç†ä»»åŠ¡é˜Ÿåˆ—

**æ ¸å¿ƒåŠŸèƒ½**:
- **ä»»åŠ¡åˆ›å»º**: åŸºäºé¡¹ç›®åˆ†æåˆ›å»ºå¤„ç†ä»»åŠ¡
- **è¿›åº¦è·Ÿè¸ª**: è·Ÿè¸ª AI å¤„ç†è¿›åº¦å’ŒçŠ¶æ€
- **æ‰¹æ¬¡ç®¡ç†**: æ™ºèƒ½æ‰¹æ¬¡å¤§å°è®¡ç®—å’Œç®¡ç†
- **è´¨é‡ä¿è¯**: æä¾›å¤„ç†æŒ‡å¯¼å’Œè´¨é‡æ ‡å‡†

**ä»»åŠ¡çŠ¶æ€ç®¡ç†**:
```javascript
this.taskStatus = {
  PENDING: 'pending',
  IN_PROGRESS: 'in_progress', 
  COMPLETED: 'completed',
  SKIPPED: 'skipped',
  ERROR: 'error'
};
```

#### 3. FileQueryService (æ–‡ä»¶æŸ¥è¯¢æœåŠ¡)

**ä½ç½®**: `server/services/file-query-service.js`  
**èŒè´£**: Step 3 çš„æ ¸å¿ƒå®ç°ï¼Œå¤„ç†æ–‡ä»¶å†…å®¹æŸ¥è¯¢å’Œåˆ†ç‰‡

**æ ¸å¿ƒç»„ä»¶**:

##### TokenCalculator (Token è®¡ç®—å™¨)
- **ç²¾ç¡®ä¼°ç®—**: æ”¯æŒä¸­è‹±æ–‡æ··åˆçš„ token ä¼°ç®—
- **ä»£ç ä¼˜åŒ–**: é’ˆå¯¹ä¸åŒç¼–ç¨‹è¯­è¨€çš„ token å¯†åº¦ä¼˜åŒ–
- **å®‰å…¨é™åˆ¶**: é¢„ç•™ç¼“å†²åŒºï¼Œé¿å…è¶…å‡º token é™åˆ¶

##### SmartChunker (æ™ºèƒ½åˆ†ç‰‡å™¨)
- **è¶…å°åˆ†ç‰‡**: æ¯ç‰‡æ§åˆ¶åœ¨ 1500 token ä»¥å†…
- **ä¿å®ˆç­–ç•¥**: åŸºäºå­—ç¬¦æ•°è€Œé token ä¼°ç®—çš„å®‰å…¨åˆ†ç‰‡
- **ç»“æ„ä¿æŒ**: ä¿æŒä»£ç ç»“æ„çš„å®Œæ•´æ€§

**åˆ†ç‰‡ç­–ç•¥**:
```javascript
// æ¯ä¸ªåˆ†ç‰‡æœ€å¤š1200ä¸ªtokenï¼Œçº¦4800å­—ç¬¦
const maxCharsPerChunk = Math.min(4800, maxTokens * 4);
```

#### 4. MasterTemplateService (ä¸»æ¨¡æ¿æœåŠ¡)

**ä½ç½®**: `server/services/unified/master-template-service.js`  
**èŒè´£**: ç»Ÿä¸€çš„æ¨¡æ¿ç®¡ç†å’Œæ¸²æŸ“

**æ¨¡æ¿ç³»ç»Ÿ**:
- **æ¨¡æ¿åˆ†ç±»**: æŒ‰æ­¥éª¤å’ŒåŠŸèƒ½åˆ†ç±»ç®¡ç†
- **å˜é‡æ›¿æ¢**: æ”¯æŒå˜é‡æ›¿æ¢å’Œæ¡ä»¶æ¸²æŸ“
- **æ™ºèƒ½é€‚é…**: æ ¹æ®è¯­è¨€å’Œé¡¹ç›®ç‰¹å¾æ™ºèƒ½é€‰æ‹©æ¨¡æ¿

#### 5. LanguageDetector (è¯­è¨€æ£€æµ‹å™¨)

**ä½ç½®**: `server/language/detector.js`  
**èŒè´£**: æ™ºèƒ½è¯­è¨€æ£€æµ‹å’Œç‰¹å¾åˆ†æ

**æ£€æµ‹æœºåˆ¶**:
- **æ–‡ä»¶æ‰©å±•å**: åŸºäºæ–‡ä»¶æ‰©å±•åçš„åŸºç¡€æ£€æµ‹
- **é…ç½®æ–‡ä»¶**: package.jsonã€requirements.txt ç­‰é…ç½®æ–‡ä»¶åˆ†æ
- **ç›®å½•ç»“æ„**: ç‰¹å®šç›®å½•ç»“æ„çš„æ¡†æ¶æ£€æµ‹
- **æ¡†æ¶ç‰¹å¾**: æ¡†æ¶ç‰¹æœ‰æ–‡ä»¶å’Œç»“æ„çš„æ£€æµ‹

### æœåŠ¡ä¾èµ–å…³ç³»

```mermaid
graph TB
    A[ConfigService] --> B[MasterTemplateService]
    C[TemplateConfigManager] --> B
    D[LanguageDetector] --> E[LanguageIntelligenceService]
    E --> B
    B --> F[ModeTemplateService]
    
    G[ProjectOverviewGenerator] --> H[Init Step 1]
    I[AITodoManager] --> J[Init Step 2]
    K[FileQueryService] --> L[Init Step 3]
    
    M[ServiceBus] -.-> A
    M -.-> C
    M -.-> D
    M -.-> G
    M -.-> I
    M -.-> K
```

## ğŸ› ï¸ MCP å·¥å…·æ¥å£

### å·¥å…·å®Œæ•´åˆ—è¡¨

| å·¥å…·åç§° | åŠŸèƒ½æè¿° | æ­¥éª¤ | å‰ç½®æ¡ä»¶ |
|---------|---------|------|----------|
| `workflow_guide` | å·¥ä½œæµå¼•å¯¼å…¥å£ | - | æ—  |
| `init_step1_project_analysis` | é¡¹ç›®åˆ†æ | 1 | æ—  |
| `init_step2_create_todos` | åˆ›å»ºAIä»»åŠ¡åˆ—è¡¨ | 2 | Step 1 å®Œæˆ |
| `init_step3_get_next_task` | è·å–ä¸‹ä¸€ä¸ªä»»åŠ¡ | 3 | Step 2 å®Œæˆ |
| `init_step3_get_file_content` | è·å–æ–‡ä»¶å†…å®¹ | 3 | è°ƒç”¨ get_next_task |
| `init_step3_generate_analysis` | AIç”Ÿæˆåˆ†æ | 3 | è°ƒç”¨ get_file_content |
| `init_step3_complete_task` | å®Œæˆä»»åŠ¡ | 3 | è°ƒç”¨ generate_analysis |
| `init_step4_module_integration` | æ¨¡å—æ•´åˆ | 4 | Step 3 å®Œæˆ |
| `init_step5_module_relations` | æ¨¡å—å…³è”åˆ†æ | 5 | Step 4 å®Œæˆ |
| `init_step6_architecture_docs` | æ¶æ„æ–‡æ¡£ç”Ÿæˆ | 6 | Step 5 å®Œæˆ |
| `get_init_status` | è·å–çŠ¶æ€ä¿¡æ¯ | - | æ—  |
| `reset_init` | é‡ç½®æµç¨‹ | - | æ—  |

### å·¥å…·è°ƒç”¨æµç¨‹çº¦æŸ

#### ä¸¥æ ¼è°ƒç”¨é¡ºåº (Step 3)
```
init_step3_get_next_task 
  â†“
init_step3_get_file_content 
  â†“
init_step3_generate_analysis 
  â†“
init_step3_complete_task
  â†“
(å¾ªç¯ç›´åˆ°æ‰€æœ‰æ–‡ä»¶å¤„ç†å®Œæˆ)
```

#### å‚æ•°è‡ªåŠ¨è¡¥å…¨æœºåˆ¶
- **ä¸Šä¸‹æ–‡ç®¡ç†**: è‡ªåŠ¨ç»´æŠ¤å½“å‰ä»»åŠ¡ä¸Šä¸‹æ–‡
- **å‚æ•°ä¼ é€’**: å·¥å…·é—´å‚æ•°è‡ªåŠ¨ä¼ é€’ï¼Œå‡å°‘æ‰‹åŠ¨è¾“å…¥
- **é”™è¯¯æ¢å¤**: è°ƒç”¨æ–­æ¡£æ—¶çš„æ™ºèƒ½æ¢å¤æœºåˆ¶

### çŠ¶æ€ç®¡ç†

#### é¡¹ç›®çŠ¶æ€ç»“æ„
```javascript
{
  currentStep: 0,
  projectPath: "ç»å¯¹è·¯å¾„",
  stepsCompleted: ["step1", "step2"],
  stepResults: {
    step1: { /* Step1ç»“æœ */ },
    step2: { /* Step2ç»“æœ */ }
  },
  startedAt: "ISOæ—¶é—´æˆ³",
  completedAt: "ISOæ—¶é—´æˆ³",
  error: null,
  documentCount: 0,
  generatedDocs: []
}
```

#### ä»»åŠ¡ä¸Šä¸‹æ–‡ç®¡ç†
```javascript
{
  taskId: "file_1_1",
  fileName: "index.js",
  relativePath: "src/index.js",
  fileContent: "æ–‡ä»¶å†…å®¹",
  currentPhase: "content_loaded",
  updatedAt: "ISOæ—¶é—´æˆ³"
}
```

## ğŸ“ é…ç½®ç³»ç»Ÿ

### é…ç½®æ–‡ä»¶ç»“æ„

#### mcp.config.json - MCP æœåŠ¡å™¨é…ç½®
```json
{
  "server": {
    "name": "mg_kiro_mcp",
    "version": "1.0.0",
    "port": 3000
  },
  "mcp": {
    "protocol_version": "2024-11-05",
    "capabilities": {
      "logging": {}, "prompts": {}, "resources": {}, "tools": {}
    }
  },
  "features": {
    "hot_reload": true,
    "health_check": true,
    "metrics": true
  }
}
```

#### workflows.config.json - å·¥ä½œæµé…ç½®
åŒ…å«å®Œæ•´çš„ 6 æ­¥å·¥ä½œæµå®šä¹‰ï¼š
- **æ­¥éª¤å®šä¹‰**: æ¯ä¸ªæ­¥éª¤çš„è¯¦ç»†é…ç½®
- **ä¾èµ–å…³ç³»**: å·¥å…·é—´çš„ä¾èµ–å…³ç³»å›¾
- **çŠ¶æ€è½¬æ¢**: çŠ¶æ€è½¬æ¢è§„åˆ™
- **æ™ºèƒ½æ¨è**: åŸºäºé¡¹ç›®å¤§å°å’Œè¯­è¨€çš„æ¨èç­–ç•¥
- **é”™è¯¯æ¢å¤**: é”™è¯¯æ£€æµ‹å’Œæ¢å¤æœºåˆ¶

#### templates.config.json - æ¨¡æ¿é…ç½®
å®šä¹‰äº† Init æ¨¡å¼çš„æ‰€æœ‰æ¨¡æ¿ï¼š
- **æ–‡ä»¶åˆ†ææ¨¡æ¿**: Step 3 ä½¿ç”¨
- **æ¨¡å—æ•´åˆæ¨¡æ¿**: Step 4 ä½¿ç”¨  
- **å…³è”åˆ†ææ¨¡æ¿**: Step 5 ä½¿ç”¨
- **æ¶æ„ç”Ÿæˆæ¨¡æ¿**: Step 6 ä½¿ç”¨

### æ¨¡æ¿ç³»ç»Ÿ

#### æ¨¡æ¿åˆ†ç±»
```
prompts/modes/init/
â”œâ”€â”€ file-documentation/     # Step 3 æ–‡ä»¶æ–‡æ¡£æ¨¡æ¿
â”œâ”€â”€ module-integration/     # Step 4 æ¨¡å—æ•´åˆæ¨¡æ¿
â”œâ”€â”€ relations-analysis/     # Step 5 å…³è”åˆ†ææ¨¡æ¿
â”œâ”€â”€ architecture-generation/ # Step 6 æ¶æ„ç”Ÿæˆæ¨¡æ¿
â”œâ”€â”€ project-analysis/       # Step 1 é¡¹ç›®åˆ†ææ¨¡æ¿
â””â”€â”€ task-creation/          # Step 2 ä»»åŠ¡åˆ›å»ºæ¨¡æ¿
```

#### å˜é‡æ›¿æ¢ç³»ç»Ÿ
æ¨¡æ¿æ”¯æŒå˜é‡æ›¿æ¢ï¼Œæ ¼å¼ï¼š`{{variable_name}}`

å¸¸ç”¨å˜é‡ï¼š
- `{{fileName}}`, `{{filePath}}` - æ–‡ä»¶ä¿¡æ¯
- `{{moduleName}}`, `{{moduleType}}` - æ¨¡å—ä¿¡æ¯
- `{{projectName}}`, `{{projectType}}` - é¡¹ç›®ä¿¡æ¯
- `{{analysisCompleted}}` - åˆ†æå®ŒæˆçŠ¶æ€

## ğŸ¯ æ™ºèƒ½ç‰¹æ€§

### 1. è‡ªåŠ¨åŒ–å‚æ•°è¡¥å…¨
- **ä¸Šä¸‹æ–‡æ„ŸçŸ¥**: è‡ªåŠ¨æ£€æµ‹å½“å‰ä»»åŠ¡ä¸Šä¸‹æ–‡
- **å‚æ•°ä¼ é€’**: å·¥å…·é—´å‚æ•°è‡ªåŠ¨ä¼ é€’
- **æ–­æ¡£æ¢å¤**: è°ƒç”¨ä¸­æ–­æ—¶çš„æ™ºèƒ½æ¢å¤

### 2. Token ç®¡ç†ä¼˜åŒ–
- **ç²¾ç¡®ä¼°ç®—**: ä¸­è‹±æ–‡æ··åˆå†…å®¹çš„ç²¾ç¡® token è®¡ç®—
- **å®‰å…¨åˆ†ç‰‡**: è¶…å¤§æ–‡ä»¶çš„å®‰å…¨åˆ†ç‰‡å¤„ç†
- **ç¼“å†²æœºåˆ¶**: é¢„ç•™ 20% ç¼“å†²åŒºé¿å…è¶…é™

### 3. è¯­è¨€æ™ºèƒ½é€‚é…
- **å¤šè¯­è¨€æ”¯æŒ**: JavaScript, Python, Java, Go, Rust, C#
- **æ¡†æ¶æ£€æµ‹**: è‡ªåŠ¨æ£€æµ‹ React, Vue, Django, Spring ç­‰æ¡†æ¶
- **ç‰¹åŒ–åˆ†æ**: åŸºäºè¯­è¨€ç‰¹æ€§çš„é’ˆå¯¹æ€§åˆ†æ

### 4. é”™è¯¯å¤„ç†å’Œæ¢å¤
- **å‰ç½®æ¡ä»¶æ£€æŸ¥**: æ¯ä¸ªå·¥å…·è°ƒç”¨å‰æ£€æŸ¥å‰ç½®æ¡ä»¶
- **æ–­ç‚¹ç»­ä¼ **: æ”¯æŒå·¥ä½œæµçš„æ–­ç‚¹ç»­ä¼ 
- **æ™ºèƒ½å»ºè®®**: é”™è¯¯å‘ç”Ÿæ—¶æä¾›ä¿®å¤å»ºè®®

## ğŸ“ˆ æ€§èƒ½ä¼˜åŒ–

### 1. å¹¶è¡Œå¤„ç†
- **Step 1**: 5 ä¸ªåˆ†æä»»åŠ¡å¹¶è¡Œæ‰§è¡Œ
- **æ–‡ä»¶å¤„ç†**: æ‰¹é‡æ–‡ä»¶çš„å¹¶è¡Œåˆ†æ
- **æ¨¡æ¿æ¸²æŸ“**: å¤šæ¨¡æ¿å¹¶è¡Œæ¸²æŸ“

### 2. ç¼“å­˜æœºåˆ¶
- **çŠ¶æ€ç¼“å­˜**: å·¥ä½œæµçŠ¶æ€æŒä¹…åŒ–åˆ°æ–‡ä»¶
- **æ¨¡æ¿ç¼“å­˜**: æ¨¡æ¿ç¼–è¯‘ç»“æœç¼“å­˜
- **åˆ†æç»“æœç¼“å­˜**: é‡å¤åˆ†æç»“æœç¼“å­˜

### 3. å†…å­˜ç®¡ç†
- **åˆ†ç‰‡å¤„ç†**: å¤§æ–‡ä»¶åˆ†ç‰‡å¤„ç†é¿å…å†…å­˜æº¢å‡º
- **åŠæ—¶é‡Šæ”¾**: å¤„ç†å®ŒæˆååŠæ—¶é‡Šæ”¾èµ„æº
- **åƒåœ¾å›æ”¶**: ä¸»åŠ¨åƒåœ¾å›æ”¶æœºåˆ¶

## ğŸš€ ä½¿ç”¨ç¤ºä¾‹

### åŸºæœ¬ä½¿ç”¨æµç¨‹

```javascript
// 1. è·å–å·¥ä½œæµæŒ‡å¼•
const guide = await callTool('workflow_guide', { workflow: 'init' });

// 2. å¼€å§‹é¡¹ç›®åˆ†æ
const step1 = await callTool('init_step1_project_analysis', {
  projectPath: '/absolute/path/to/project'
});

// 3. åˆ›å»ºä»»åŠ¡åˆ—è¡¨
const step2 = await callTool('init_step2_create_todos', {
  projectPath: '/absolute/path/to/project'
});

// 4. å¼€å§‹æ–‡ä»¶å¤„ç†å¾ªç¯
let hasMoreTasks = true;
while (hasMoreTasks) {
  // è·å–ä¸‹ä¸€ä¸ªä»»åŠ¡
  const task = await callTool('init_step3_get_next_task', {
    projectPath: '/absolute/path/to/project'
  });
  
  if (!task.hasMoreTasks) {
    hasMoreTasks = false;
    break;
  }
  
  // è·å–æ–‡ä»¶å†…å®¹
  const content = await callTool('init_step3_get_file_content', {
    projectPath: '/absolute/path/to/project',
    relativePath: task.relativePath
  });
  
  // AI ç”Ÿæˆåˆ†æï¼ˆéœ€è¦ AI å‚ä¸ï¼‰
  const analysis = await callTool('init_step3_generate_analysis', {
    projectPath: '/absolute/path/to/project',
    analysisContent: "AIç”Ÿæˆçš„åˆ†æå†…å®¹"
  });
  
  // å®Œæˆä»»åŠ¡
  await callTool('init_step3_complete_task', {
    projectPath: '/absolute/path/to/project',
    taskId: task.taskId
  });
}

// 5. æ¨¡å—æ•´åˆ
const step4 = await callTool('init_step4_module_integration', {
  projectPath: '/absolute/path/to/project'
});

// 6. å…³è”åˆ†æ
const step5 = await callTool('init_step5_module_relations', {
  projectPath: '/absolute/path/to/project'
});

// 7. æ¶æ„æ–‡æ¡£ç”Ÿæˆ
const step6 = await callTool('init_step6_architecture_docs', {
  projectPath: '/absolute/path/to/project'
});
```

### çŠ¶æ€ç›‘æ§

```javascript
// æŸ¥çœ‹å½“å‰çŠ¶æ€
const status = await callTool('get_init_status', {
  projectPath: '/absolute/path/to/project'
});

console.log(`è¿›åº¦: ${status.progress.percentage}%`);
console.log(`å½“å‰æ­¥éª¤: ${status.currentStep}`);
console.log(`ç”Ÿæˆæ–‡æ¡£æ•°: ${status.documentCount}`);

// é‡ç½®æµç¨‹
await callTool('reset_init', {
  projectPath: '/absolute/path/to/project'
});
```

## ğŸ“‚ è¾“å‡ºæ–‡æ¡£ç»“æ„

å®Œæ•´çš„ 6 æ­¥æµç¨‹ä¼šåœ¨é¡¹ç›®æ ¹ç›®å½•ç”Ÿæˆ `mg_kiro/` æ–‡æ¡£ç›®å½•ï¼š

```
mg_kiro/
â”œâ”€â”€ .tmp/                          # ä¸´æ—¶æ–‡ä»¶ç›®å½•
â”‚   â”œâ”€â”€ init-state.json           # å·¥ä½œæµçŠ¶æ€
â”‚   â”œâ”€â”€ current-task-context.json # å½“å‰ä»»åŠ¡ä¸Šä¸‹æ–‡
â”‚   â””â”€â”€ step*-result.json         # å„æ­¥éª¤ç»“æœ
â”œâ”€â”€ files/                         # Step 3: æ–‡ä»¶çº§æ–‡æ¡£
â”‚   â”œâ”€â”€ src-index.js.md
â”‚   â”œâ”€â”€ src-utils-helper.js.md
â”‚   â””â”€â”€ ...
â”œâ”€â”€ modules/                       # Step 4: æ¨¡å—çº§æ–‡æ¡£
â”‚   â”œâ”€â”€ core-module-overview.md
â”‚   â”œâ”€â”€ api-module-overview.md
â”‚   â””â”€â”€ ...
â”œâ”€â”€ relations/                     # Step 5: å…³è”åˆ†ææ–‡æ¡£
â”‚   â”œâ”€â”€ function-calls-analysis.md
â”‚   â”œâ”€â”€ module-dependencies.md
â”‚   â”œâ”€â”€ data-flows-analysis.md
â”‚   â””â”€â”€ relations-overview.md
â”œâ”€â”€ README.md                      # Step 6: é¡¹ç›®ä¸»æ–‡æ¡£
â”œâ”€â”€ architecture.md               # Step 6: æ¶æ„è®¾è®¡æ–‡æ¡£
â”œâ”€â”€ development.md                 # Step 6: å¼€å‘æŒ‡å—
â””â”€â”€ docs-index.md                  # Step 6: æ–‡æ¡£ç´¢å¼•
```

## ğŸ”§ æ‰©å±•å’Œå®šåˆ¶

### æ·»åŠ æ–°çš„åˆ†ææ­¥éª¤

1. **å®šä¹‰æ–°å·¥å…·**: åœ¨ `index.js` ä¸­æ·»åŠ  MCP å·¥å…·å®šä¹‰
2. **å®ç°æœåŠ¡**: åœ¨ `server/services/` ä¸­åˆ›å»ºå¯¹åº”æœåŠ¡
3. **æ³¨å†ŒæœåŠ¡**: åœ¨ `service-registry.js` ä¸­æ³¨å†ŒæœåŠ¡
4. **é…ç½®å·¥ä½œæµ**: åœ¨ `workflows.config.json` ä¸­æ·»åŠ æ­¥éª¤é…ç½®
5. **åˆ›å»ºæ¨¡æ¿**: åœ¨ `prompts/modes/init/` ä¸­æ·»åŠ æ¨¡æ¿

### æ”¯æŒæ–°çš„ç¼–ç¨‹è¯­è¨€

1. **æ‰©å±•æ£€æµ‹å™¨**: åœ¨ `detector.js` ä¸­æ·»åŠ è¯­è¨€æ£€æµ‹è§„åˆ™
2. **æ·»åŠ æ¨¡æ¿**: åœ¨ `prompts/languages/` ä¸­åˆ›å»ºè¯­è¨€ç‰¹å®šæ¨¡æ¿
3. **é…ç½®ç‰¹å¾**: åœ¨é…ç½®æ–‡ä»¶ä¸­æ·»åŠ è¯­è¨€ç‰¹å¾å®šä¹‰

### è‡ªå®šä¹‰åˆ†ææ¨¡æ¿

1. **åˆ›å»ºæ¨¡æ¿æ–‡ä»¶**: åœ¨å¯¹åº”ç›®å½•åˆ›å»º `.md` æ¨¡æ¿æ–‡ä»¶
2. **å®šä¹‰å˜é‡**: åœ¨æ¨¡æ¿ä¸­ä½¿ç”¨ `{{variable}}` æ ¼å¼å®šä¹‰å˜é‡
3. **æ³¨å†Œæ¨¡æ¿**: åœ¨ `templates.config.json` ä¸­æ³¨å†Œæ¨¡æ¿
4. **é…ç½®ä½¿ç”¨**: åœ¨å·¥ä½œæµé…ç½®ä¸­æŒ‡å®šæ¨¡æ¿ä½¿ç”¨

## ğŸ‰ æ€»ç»“

mg_kiro MCP Server çš„ Init Mode æ˜¯ä¸€ä¸ªå®Œæ•´çš„é¡¹ç›®æ–‡æ¡£ç”Ÿæˆè§£å†³æ–¹æ¡ˆï¼Œé€šè¿‡ 6 æ­¥æ™ºèƒ½åŒ–æµç¨‹ï¼Œä»é¡¹ç›®åˆ†æåˆ°æœ€ç»ˆæ–‡æ¡£ç”Ÿæˆï¼Œæä¾›äº†ï¼š

### æ ¸å¿ƒä¼˜åŠ¿
1. **å®Œæ•´æ€§**: 6 æ­¥æµç¨‹è¦†ç›–ä»åˆ†æåˆ°æ–‡æ¡£çš„å…¨è¿‡ç¨‹
2. **æ™ºèƒ½åŒ–**: AI åä½œ + è‡ªåŠ¨åŒ–å‚æ•°è¡¥å…¨ + ä¸Šä¸‹æ–‡ç®¡ç†
3. **å¯æ‰©å±•**: æ¨¡å—åŒ–æ¶æ„æ”¯æŒåŠŸèƒ½æ‰©å±•å’Œå®šåˆ¶
4. **é«˜æ•ˆæ€§**: å¹¶è¡Œå¤„ç† + æ™ºèƒ½åˆ†ç‰‡ + ç¼“å­˜æœºåˆ¶
5. **æ˜“ç”¨æ€§**: ä¸€é”®å¯åŠ¨ + è¿›åº¦ç›‘æ§ + é”™è¯¯æ¢å¤

### æŠ€æœ¯äº®ç‚¹
- **æœåŠ¡æ€»çº¿æ¶æ„**: æ¾è€¦åˆçš„æœåŠ¡æ¶æ„
- **æ™ºèƒ½ Token ç®¡ç†**: ç²¾ç¡®çš„ token è®¡ç®—å’Œå®‰å…¨åˆ†ç‰‡
- **æ¨¡æ¿ç³»ç»Ÿ**: çµæ´»çš„æ¨¡æ¿ç®¡ç†å’Œæ¸²æŸ“
- **å¤šè¯­è¨€æ”¯æŒ**: å¹¿æ³›çš„ç¼–ç¨‹è¯­è¨€å’Œæ¡†æ¶æ”¯æŒ
- **çŠ¶æ€ç®¡ç†**: å®Œæ•´çš„å·¥ä½œæµçŠ¶æ€ç®¡ç†

Init Mode ä¸ºå¼€å‘è€…æä¾›äº†ä¸€ä¸ªå¼ºå¤§çš„é¡¹ç›®æ–‡æ¡£åŒ–å·¥å…·ï¼Œé€šè¿‡ä¸ Claude Code çš„æ·±åº¦é›†æˆï¼Œå®ç°äº†é«˜æ•ˆã€æ™ºèƒ½çš„é¡¹ç›®æ–‡æ¡£ç”Ÿæˆä½“éªŒã€‚

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0  
**ç”Ÿæˆæ—¶é—´**: 2025-01-11  
**åˆ†æåŸºå‡†**: mg_kiro v4.0.0-complete-6-steps