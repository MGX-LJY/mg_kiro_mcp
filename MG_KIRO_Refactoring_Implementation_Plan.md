# MG_KIRO é‡æ„å®æ–½è®¡åˆ’

## ğŸ“‹ é¡¹ç›®é‡æ„æ€»è§ˆ

åŸºäºæ–°çš„å·¥ä½œæµç¨‹è®¾è®¡ï¼Œéœ€è¦å¯¹ mg_kiro MCP Server è¿›è¡Œå…¨é¢é‡æ„ï¼Œå¼•å…¥æ™ºèƒ½æ–‡ä»¶åˆ†ææ¨¡å—ä½œä¸ºç³»ç»Ÿå¤§è„‘ï¼Œå®ç°åˆ†å±‚éªŒè¯ç­–ç•¥å’Œç»Ÿä¸€ä»»åŠ¡ç®¡ç†ã€‚

### ğŸ¯ é‡æ„ç›®æ ‡
- **åˆ é™¤å†—ä½™åŠŸèƒ½**: ç§»é™¤ aiGenerationGuide ç›¸å…³ä»£ç 
- **å¼•å…¥æ™ºèƒ½æ ¸å¿ƒ**: FileAnalysisModule ä½œä¸ºåè°ƒå¤§è„‘
- **ä¸‰ç§æ‰¹æ¬¡ç­–ç•¥**: ç»¼åˆæ–‡ä»¶æ‰¹æ¬¡ã€å•æ–‡ä»¶å•æ‰¹æ¬¡ã€å¤§æ–‡ä»¶å¤šæ‰¹æ¬¡
- **åˆ†å±‚éªŒè¯æœºåˆ¶**: Step3æ–‡ä»¶å¤¹æ£€æŸ¥ã€Step4æ¨¡å—æ–‡ä»¶å¤¹æ£€æŸ¥ã€Step5/6å›ºå®šæ–‡ä»¶æ£€æŸ¥
- **ç»Ÿä¸€ä»»åŠ¡ç®¡ç†**: æ‰©å±•åˆ°å…¨éƒ¨6ä¸ªæ­¥éª¤

---

## ğŸ—‚ï¸ ç¬¬ä¸€é˜¶æ®µï¼šæ ¸å¿ƒæ¶æ„æ­å»º

### ğŸ“ 1.1 åˆ›å»ºæ–‡ä»¶åˆ†ææ¨¡å—ç›®å½•ç»“æ„

**æ–°å¢ç›®å½•**: `server/services/file-analysis/`
```
file-analysis/
â”œâ”€â”€ FileAnalysisModule.js          # ä¸»è¦åè°ƒæ¨¡å—
â”œâ”€â”€ token-analysis/
â”‚   â”œâ”€â”€ PreciseTokenCalculator.js  # ç²¾ç¡®Tokenè®¡ç®—å™¨
â”‚   â”œâ”€â”€ CodeStructureAnalyzer.js   # ä»£ç ç»“æ„åˆ†æå™¨
â”‚   â””â”€â”€ FunctionBoundaryDetector.js # å‡½æ•°è¾¹ç•Œæ£€æµ‹å™¨
â”œâ”€â”€ batch-strategies/
â”‚   â”œâ”€â”€ CombinedFileBatchStrategy.js # ç»¼åˆæ–‡ä»¶æ‰¹æ¬¡ç­–ç•¥
â”‚   â”œâ”€â”€ SingleFileBatchStrategy.js   # å•æ–‡ä»¶å•æ‰¹æ¬¡ç­–ç•¥
â”‚   â””â”€â”€ LargeFileMultiBatchStrategy.js # å¤§æ–‡ä»¶å¤šæ‰¹æ¬¡ç­–ç•¥
â””â”€â”€ task-generators/
    â”œâ”€â”€ TaskDefinitionGenerator.js  # ä»»åŠ¡å®šä¹‰ç”Ÿæˆå™¨
    â””â”€â”€ TaskProgressTracker.js      # ä»»åŠ¡è¿›åº¦è·Ÿè¸ªå™¨
```

**éœ€è¦å®ç°çš„æ ¸å¿ƒåŠŸèƒ½**:
- Tokenç²¾ç¡®è®¡ç®—ï¼ˆè€ƒè™‘ä¸åŒè¯­è¨€ç‰¹æ€§ï¼‰
- æ™ºèƒ½æ–‡ä»¶åˆ†ç»„ç®—æ³•
- ä¸‰ç§æ‰¹æ¬¡ç­–ç•¥çš„å…·ä½“å®ç°
- ä»»åŠ¡IDç”Ÿæˆè§„èŒƒï¼ˆtask_1, task_2_1ç­‰ï¼‰

### ğŸ“ 1.2 åˆ›å»ºç»Ÿä¸€ä»»åŠ¡ç®¡ç†ç›®å½•ç»“æ„

**æ–°å¢ç›®å½•**: `server/services/task-management/`
```
task-management/
â”œâ”€â”€ UnifiedTaskManager.js          # ç»Ÿä¸€ä»»åŠ¡ç®¡ç†å™¨ï¼ˆé‡æ„ç‰ˆï¼‰
â”œâ”€â”€ UnifiedTaskValidator.js.js     # ç®€åŒ–ä»»åŠ¡éªŒè¯å™¨
â”œâ”€â”€ TaskStateManager.js            # ä»»åŠ¡çŠ¶æ€ç®¡ç†å™¨
â””â”€â”€ validation-strategies/
    â”œâ”€â”€ Step3FolderValidator.js     # Step3æ–‡ä»¶å¤¹éªŒè¯
    â”œâ”€â”€ Step4ModuleValidator.js     # Step4æ¨¡å—æ–‡ä»¶å¤¹éªŒè¯
    â”œâ”€â”€ Step5FixedFileValidator.js  # Step5å›ºå®šæ–‡ä»¶éªŒè¯
    â””â”€â”€ Step6ArchitectureValidator.js # Step6æ¶æ„æ–‡æ¡£éªŒè¯
```

**éœ€è¦å®ç°çš„æ ¸å¿ƒåŠŸèƒ½**:
- åˆ†å±‚éªŒè¯ç­–ç•¥
- è‡ªåŠ¨ä»»åŠ¡å®Œæˆæœºåˆ¶
- ä»»åŠ¡çŠ¶æ€ç®¡ç†å’Œè¿½è¸ª
- é”™è¯¯æ£€æµ‹å’Œé‡è¯•é€»è¾‘

---

## ğŸ”§ ç¬¬äºŒé˜¶æ®µï¼šç§»é™¤å†—ä½™åŠŸèƒ½

### ğŸ—‘ï¸ 2.1 åˆ é™¤ aiGenerationGuide ç›¸å…³ä»£ç 

**éœ€è¦ä¿®æ”¹çš„æ–‡ä»¶**: `index.js`
- **ä½ç½®**: Step1 é¡¹ç›®åˆ†æå·¥å…·ï¼ˆçº¦ç¬¬749-854è¡Œï¼‰
- **åˆ é™¤å†…å®¹**: 
  - aiGenerationGuide ç›¸å…³çš„æ•°æ®ç”Ÿæˆé€»è¾‘
  - æ‰¹æ¬¡å¤§å°å»ºè®®åŠŸèƒ½
  - æ–‡æ¡£ç­–ç•¥å»ºè®®åŠŸèƒ½
- **ä¿ç•™å†…å®¹**:
  - é¡¹ç›®å…ƒæ•°æ®æ”¶é›†
  - è¯­è¨€æ£€æµ‹å’Œæ¡†æ¶è¯†åˆ«
  - ç›®å½•ç»“æ„åˆ†æ
  - åŸºç¡€ä¾èµ–å…³ç³»æå–

**éœ€è¦ä¿®æ”¹çš„æœåŠ¡æ–‡ä»¶**:
- `server/services/project-overview-generator.js` - ç§»é™¤ aiGenerationGuide ç”Ÿæˆé€»è¾‘
- ç›¸å…³çš„é…ç½®æ–‡ä»¶ä¸­ç§»é™¤ aiGenerationGuide ç›¸å…³é…ç½®

### ğŸ”„ 2.2 é‡æ„ Step1 è¾“å‡ºæ ¼å¼

**ä¿®æ”¹å†…å®¹**:
- ç®€åŒ– Step1 è¾“å‡ºï¼Œç§»é™¤ aiGenerationGuide å­—æ®µ
- è°ƒæ•´æ•°æ®ç»“æ„ï¼Œä¸º Step2 FileAnalysisModule æä¾›æ‰€éœ€çš„åŸºç¡€æ•°æ®
- æ›´æ–°å“åº”æ ¼å¼ï¼Œç¡®ä¿ä¸æ–°çš„å·¥ä½œæµç¨‹å…¼å®¹

---

## ğŸ§  ç¬¬ä¸‰é˜¶æ®µï¼šå®ç°æ–‡ä»¶åˆ†ææ¨¡å—

### ğŸ”¨ 3.1 å®ç° FileAnalysisModule æ ¸å¿ƒ

**æ–°æ–‡ä»¶**: `server/services/file-analysis/FileAnalysisModule.js`

**æ ¸å¿ƒåŠŸèƒ½å®ç°**:
1. **ç²¾ç¡®Tokenåˆ†æ**
   - é›†æˆ PreciseTokenCalculator
   - æ”¯æŒå¤šè¯­è¨€Tokenè®¡ç®—
   - è€ƒè™‘æ³¨é‡Šã€å­—ç¬¦ä¸²ã€å‡½æ•°ç»“æ„ç­‰å› ç´ 

2. **æ™ºèƒ½æ‰¹æ¬¡åˆ†é…**
   - å°æ–‡ä»¶ï¼ˆ<15K tokensï¼‰â†’ ç»¼åˆæ–‡ä»¶æ‰¹æ¬¡ç­–ç•¥
   - ä¸­ç­‰æ–‡ä»¶ï¼ˆ15K-20K tokensï¼‰â†’ å•æ–‡ä»¶å•æ‰¹æ¬¡ç­–ç•¥  
   - å¤§æ–‡ä»¶ï¼ˆ>20K tokensï¼‰â†’ å¤§æ–‡ä»¶å¤šæ‰¹æ¬¡ç­–ç•¥

3. **ä»»åŠ¡å®šä¹‰ç”Ÿæˆ**
   - ç”Ÿæˆæ ‡å‡†åŒ–ä»»åŠ¡IDï¼ˆtask_1, task_2_1, task_2_2ç­‰ï¼‰
   - åˆ›å»ºä»»åŠ¡å…ƒæ•°æ®ï¼ˆé¢„æœŸæ–‡ä»¶ã€å¤„ç†ç­–ç•¥ç­‰ï¼‰
   - ç”Ÿæˆæ‰¹æ¬¡å¤„ç†è®¡åˆ’

### ğŸ”¨ 3.2 å®ç°ä¸‰ç§æ‰¹æ¬¡ç­–ç•¥

**ç»¼åˆæ–‡ä»¶æ‰¹æ¬¡ç­–ç•¥** (`CombinedFileBatchStrategy.js`)
- å°†å¤šä¸ªå°æ–‡ä»¶åˆå¹¶åˆ°ä¸€ä¸ªæ‰¹æ¬¡
- ç›®æ ‡ï¼šæ¯æ‰¹æ¬¡çº¦18K tokens
- ç”Ÿæˆä¸€ä¸ªä»»åŠ¡IDï¼ŒåŒ…å«å¤šä¸ªæ–‡ä»¶

**å•æ–‡ä»¶å•æ‰¹æ¬¡ç­–ç•¥** (`SingleFileBatchStrategy.js`)
- ä¸­ç­‰å¤§å°æ–‡ä»¶ç‹¬ç«‹å¤„ç†
- ä¸€ä¸ªæ–‡ä»¶ä¸€ä¸ªæ‰¹æ¬¡
- ç”Ÿæˆç‹¬ç«‹çš„ä»»åŠ¡ID

**å¤§æ–‡ä»¶å¤šæ‰¹æ¬¡ç­–ç•¥** (`LargeFileMultiBatchStrategy.js`)
- å¤§æ–‡ä»¶æ™ºèƒ½æ‹†åˆ†
- å‡½æ•°è¾¹ç•Œæ£€æµ‹ï¼Œé¿å…ç ´åä»£ç ç»“æ„
- ç”Ÿæˆå¤šä¸ªå­ä»»åŠ¡IDï¼ˆtask_X_1, task_X_2ç­‰ï¼‰

### ğŸ”¨ 3.3 Tokenè®¡ç®—å™¨å®ç°

**æ–°æ–‡ä»¶**: `server/services/file-analysis/token-analysis/PreciseTokenCalculator.js`

**éœ€è¦å®ç°çš„åŠŸèƒ½**:
- æ”¯æŒä¸åŒç¼–ç¨‹è¯­è¨€çš„Tokenè®¡ç®—è§„åˆ™
- å‡†ç¡®å¤„ç†æ³¨é‡Šã€å­—ç¬¦ä¸²ã€å…³é”®å­—æƒé‡
- æä¾›Tokené¢„ä¼°å’Œå®é™…è®¡ç®—
- ç¼“å­˜æœºåˆ¶ä¼˜åŒ–æ€§èƒ½

---

## ğŸ¯ ç¬¬å››é˜¶æ®µï¼šé‡æ„éªŒè¯æœºåˆ¶

### ğŸ”¨ 4.1 å®ç° UnifiedTaskValidator.js

**æ–°æ–‡ä»¶**: `server/services/task-management/UnifiedTaskValidator.js.js`

**æ ¸å¿ƒæ–¹æ³•é‡æ„**:
1. **checkTaskCompletion()** - æ›¿ä»£åŸæ¥çš„ validateAndCompleteTask()
2. **åˆ†å±‚éªŒè¯ç­–ç•¥**:
   - Step3: æ£€æŸ¥æ–‡æ¡£æ–‡ä»¶å¤¹æ˜¯å¦æœ‰.mdæ–‡ä»¶
   - Step4: æ£€æŸ¥æ¨¡å—æ–‡æ¡£æ–‡ä»¶å¤¹æ˜¯å¦æœ‰.mdæ–‡ä»¶  
   - Step5: æ£€æŸ¥ relations.md æ˜¯å¦å­˜åœ¨
   - Step6: æ£€æŸ¥ README.md, architecture.md æ˜¯å¦å­˜åœ¨

3. **è‡ªåŠ¨å®Œæˆæœºåˆ¶**:
   - éªŒè¯é€šè¿‡æ—¶è‡ªåŠ¨è°ƒç”¨ä»»åŠ¡ç®¡ç†å™¨å®Œæˆä»»åŠ¡
   - éªŒè¯å¤±è´¥æ—¶æä¾›å…·ä½“çš„ç¼ºå¤±æ–‡ä»¶ä¿¡æ¯

### ğŸ”¨ 4.2 åˆ›å»ºå…·ä½“éªŒè¯ç­–ç•¥

**å››ä¸ªéªŒè¯ç­–ç•¥æ–‡ä»¶**:
- `Step3FolderValidator.js` - æ–‡ä»¶å¤¹å†…å®¹æ£€æŸ¥
- `Step4ModuleValidator.js` - æ¨¡å—æ–‡æ¡£æ–‡ä»¶å¤¹æ£€æŸ¥
- `Step5FixedFileValidator.js` - relations.md æ–‡ä»¶æ£€æŸ¥
- `Step6ArchitectureValidator.js` - æ¶æ„æ–‡æ¡£æ–‡ä»¶æ£€æŸ¥

**æ¯ä¸ªéªŒè¯å™¨éœ€è¦å®ç°**:
- ç‰¹å®šçš„éªŒè¯é€»è¾‘
- é”™è¯¯ä¿¡æ¯ç”Ÿæˆ
- è‡ªåŠ¨å®Œæˆè§¦å‘

---

## ğŸ”„ ç¬¬äº”é˜¶æ®µï¼šé‡æ„ç°æœ‰å·¥å…·

### ğŸ”¨ 5.1 é‡æ„ init_step2_create_todos

**ä¿®æ”¹æ–‡ä»¶**: `index.js` ï¼ˆçº¦ç¬¬854-971è¡Œï¼‰

**é‡æ„å†…å®¹**:
- ç§»é™¤åŸæ¥çš„ç®€å•ä»»åŠ¡åˆ›å»ºé€»è¾‘
- é›†æˆ FileAnalysisModule
- è°ƒç”¨æ–‡ä»¶åˆ†ææ¨¡å—ç”Ÿæˆæ™ºèƒ½æ‰¹æ¬¡è®¡åˆ’
- è¾“å‡ºè¯¦ç»†çš„ä»»åŠ¡å®šä¹‰å’Œå¤„ç†ç­–ç•¥

**æ–°çš„å·¥ä½œæµç¨‹**:
1. æ¥æ”¶ Step1 çš„é¡¹ç›®åŸºç¡€æ•°æ®
2. è°ƒç”¨ FileAnalysisModule è¿›è¡Œæ–‡ä»¶åˆ†æ
3. ç”Ÿæˆä¸‰ç§ç­–ç•¥çš„æ‰¹æ¬¡è®¡åˆ’
4. åˆ›å»ºä»»åŠ¡é˜Ÿåˆ—å’Œå¤„ç†ç­–ç•¥
5. è¿”å›å®Œæ•´çš„ä»»åŠ¡ç®¡ç†è®¡åˆ’

### ğŸ”¨ 5.2 é‡æ„ init_step3 ç³»åˆ—å·¥å…·

**éœ€è¦é‡æ„çš„å·¥å…·**:
- `init_step3_get_next_task` - ä¸FileAnalysisModuleåè°ƒ
- `init_step3_get_file_content` - æ”¯æŒæ‰¹æ¬¡ç­–ç•¥
- `init_step3_generate_analysis` - é€‚é…æ–°çš„æ‰¹æ¬¡ç±»å‹
- `init_step3_complete_task` - ä½¿ç”¨æ–°çš„éªŒè¯æœºåˆ¶

**é‡æ„è¦ç‚¹**:
- æ‰€æœ‰Step3å·¥å…·éƒ½è¦ä¸FileAnalysisModuleåè°ƒ
- æ”¯æŒä¸‰ç§ä¸åŒçš„æ‰¹æ¬¡å¤„ç†æ¨¡å¼
- ä½¿ç”¨UnifiedTaskValidator.jsè¿›è¡ŒéªŒè¯
- å®ç°è‡ªåŠ¨ä»»åŠ¡å®Œæˆæœºåˆ¶

### ğŸ”¨ 5.3 æ‰©å±• Step4-6 ç»Ÿä¸€ä»»åŠ¡ç®¡ç†

**é‡æ„ init_step4_module_integration**:
- ä½¿ç”¨ UnifiedTaskManager åˆ›å»ºæ¨¡å—æ•´åˆä»»åŠ¡
- åº”ç”¨æ–‡ä»¶å¤¹éªŒè¯ç­–ç•¥
- è‡ªåŠ¨å®Œæˆæœºåˆ¶

**é‡æ„ init_step5_module_relations**:
- ç»Ÿä¸€ä»»åŠ¡ç®¡ç†
- å›ºå®šæ–‡ä»¶éªŒè¯ï¼ˆrelations.mdï¼‰
- è‡ªåŠ¨å®Œæˆæœºåˆ¶

**é‡æ„ init_step6_architecture_docs**:
- ç»Ÿä¸€ä»»åŠ¡ç®¡ç†  
- å›ºå®šæ–‡ä»¶éªŒè¯ï¼ˆREADME.md, architecture.mdï¼‰
- è‡ªåŠ¨å®Œæˆæœºåˆ¶

---

## ğŸ“¡ ç¬¬å…­é˜¶æ®µï¼šMCPå·¥å…·æ¥å£æ›´æ–° âœ… **å·²å®Œæˆ**

### ğŸ”¨ 6.1 æ–°å¢å·¥å…·æ¥å£å®šä¹‰ âœ…

**ä¿®æ”¹æ–‡ä»¶**: `index.js` å·¥å…·å®šä¹‰éƒ¨åˆ†

**æ–°å¢å·¥å…·**:
```javascript
{
  name: "init_step2_file_analysis", 
  description: "Step2: æ–‡ä»¶åˆ†ææ¨¡å— - æ™ºèƒ½Tokenåˆ†æå’Œæ‰¹æ¬¡è§„åˆ’ï¼Œä½¿ç”¨FileAnalysisModuleä½œä¸ºç³»ç»Ÿå¤§è„‘è¿›è¡Œç²¾ç¡®çš„æ–‡ä»¶åˆ†æå’Œæ™ºèƒ½æ‰¹æ¬¡åˆ†é…"
}
```

**ä¿®æ”¹ç°æœ‰å·¥å…·** âœ…:
- âœ… æ›´æ–°Step4-6å·¥å…·æè¿°ï¼Œåæ˜ ç»Ÿä¸€ä»»åŠ¡ç®¡ç†å™¨å’Œæ–°éªŒè¯æœºåˆ¶
- âœ… init_step3_check_task_completion æ”¯æŒstepTypeå‚æ•°
- âœ… æ ‡è®°init_step3_complete_taskä¸ºåºŸå¼ƒå·¥å…·

### ğŸ”¨ 6.2 æ›´æ–°å·¥å…·æ‰§è¡Œé€»è¾‘ âœ…

**é‡å¤§ä¿®æ”¹ç‚¹**:
1. **init_step3_complete_task** â†’ **init_step3_check_task_completion** âœ…
   - âœ… æ–°å¢ stepType å‚æ•°æ”¯æŒStep3-6éªŒè¯
   - âœ… ä½¿ç”¨åˆ†å±‚éªŒè¯ç­–ç•¥ï¼ˆUnifiedTaskValidatorï¼‰
   - âœ… å®ç°è‡ªåŠ¨å®Œæˆæœºåˆ¶
   - âœ… åºŸå¼ƒæ—§å·¥å…·å¹¶æä¾›è¿ç§»æŒ‡å¯¼

2. **æ‰€æœ‰Stepå·¥å…·** âœ…:
   - âœ… Step4-6é›†æˆ UnifiedTaskManager
   - âœ… ä½¿ç”¨ UnifiedTaskValidator è¿›è¡ŒéªŒè¯
   - âœ… ç»Ÿä¸€é”™è¯¯å¤„ç†å’Œå“åº”æ ¼å¼
   - âœ… æ›´æ–°next_stepsæŒ‡å‘æ–°éªŒè¯å·¥å…·

**å®ŒæˆçŠ¶æ€**:
- âœ… å·¥å…·æ¥å£å®šä¹‰æ›´æ–°å®Œæˆ
- âœ… åºŸå¼ƒå·¥å…·æ ‡è®°å’Œè¿ç§»æŒ‡å¯¼å®Œæˆ  
- âœ… æ‰€æœ‰å·¥å…·æè¿°æ›´æ–°å®Œæˆ
- âœ… é”™è¯¯æ¶ˆæ¯ä¸­å·¥å…·åˆ—è¡¨æ›´æ–°å®Œæˆ

---

## ğŸ§ª ç¬¬ä¸ƒé˜¶æ®µï¼šæœåŠ¡æ³¨å†Œå’Œé›†æˆ âœ… **å·²å®Œæˆ**

### ğŸ”¨ 7.1 æ›´æ–°æœåŠ¡æ³¨å†Œ âœ…

**ä¿®æ”¹æ–‡ä»¶**: `server/services/service-registry.js`

**æ–°å¢æœåŠ¡æ³¨å†Œ** âœ…:
```javascript
// æ–‡ä»¶åˆ†ææ¨¡å—å±‚ï¼ˆä¾èµ–åŸºç¡€æœåŠ¡ï¼‰
serviceBus
    .register('preciseTokenCalculator', PreciseTokenCalculator, {}, [])
    .register('combinedFileBatchStrategy', CombinedFileBatchStrategy, {}, [])
    .register('singleFileBatchStrategy', SingleFileBatchStrategy, {}, [])
    .register('largeFileMultiBatchStrategy', LargeFileMultiBatchStrategy, {}, [])
    .register('taskStateManager', TaskStateManager, {}, []);

// æ–‡ä»¶åˆ†ææ¨¡å—æ ¸å¿ƒï¼ˆä¾èµ–Tokenè®¡ç®—å™¨å’Œæ‰¹æ¬¡ç­–ç•¥ï¼‰
serviceBus
    .register('fileAnalysisModule', FileAnalysisModule, {}, [
        'preciseTokenCalculator',
        'combinedFileBatchStrategy',
        'singleFileBatchStrategy',
        'largeFileMultiBatchStrategy'
    ]);

// ä»»åŠ¡ç®¡ç†æ¨¡å—ï¼ˆä¾èµ–æ–‡ä»¶åˆ†ææ¨¡å—ï¼‰
serviceBus
    .register('unifiedTaskValidator', UnifiedTaskValidator, {}, [
        'fileAnalysisModule',
        'taskStateManager'
    ])
    .register('unifiedTaskManager', UnifiedTaskManager, {}, [
        'taskStateManager',
        'unifiedTaskValidator'
    ]);
```

### ğŸ”¨ 7.2 æ›´æ–°æœåŠ¡å®¹å™¨ âœ…

**ä¿®æ”¹æ–‡ä»¶**: `index.js` çš„ getServiceContainer å‡½æ•°

**æ–°å¢æœåŠ¡å¼•ç”¨** âœ…:
```javascript
// æ–°çš„æ–‡ä»¶åˆ†ææ¨¡å—å’Œä»»åŠ¡ç®¡ç†æœåŠ¡
fileAnalysisModule: serviceBus.get('fileAnalysisModule'),
unifiedTaskManager: serviceBus.get('unifiedTaskManager'),
unifiedTaskValidator: serviceBus.get('unifiedTaskValidator'),
taskStateManager: serviceBus.get('taskStateManager'),

// æ–‡ä»¶åˆ†ææ¨¡å—ç»„ä»¶ï¼ˆå¯é€‰ç›´æ¥è®¿é—®ï¼‰
preciseTokenCalculator: serviceBus.get('preciseTokenCalculator'),
combinedFileBatchStrategy: serviceBus.get('combinedFileBatchStrategy'),
singleFileBatchStrategy: serviceBus.get('singleFileBatchStrategy'),
largeFileMultiBatchStrategy: serviceBus.get('largeFileMultiBatchStrategy'),
```

### ğŸ”¨ 7.3 ä¾èµ–æ³¨å…¥ä¿®æ­£ âœ…

**ä¿®æ­£æ„é€ å‡½æ•°ç­¾å** âœ…:
- âœ… UnifiedTaskManager: ä¿®æ­£ä¸ºServiceBusæ ¼å¼ `(config, dependencies, serviceBus)`
- âœ… UnifiedTaskValidator: ä¿®æ­£ä¸ºServiceBusæ ¼å¼ `(config, dependencies, serviceBus)`
- âœ… FileAnalysisModule: ä¿®æ­£ä¸ºServiceBusæ ¼å¼ `(config, dependencies, serviceBus)`
- âœ… TaskStateManager: ä¿®æ­£ä¸ºServiceBusæ ¼å¼ `(config, dependencies, serviceBus)`

**å¾ªç¯ä¾èµ–è§£å†³** âœ…:
- âœ… åœ¨`service-registry.js`ä¸­é€šè¿‡`injectDependencies`è®¾ç½®å¾ªç¯ä¾èµ–
- âœ… UnifiedTaskValidatorè·å¾—UnifiedTaskManagerå¼•ç”¨

### ğŸ”¨ 7.4 éªŒè¯æµ‹è¯• âœ…

**åˆ›å»ºæµ‹è¯•è„šæœ¬** âœ…: `scripts/test-service-registry.js`
- âœ… éªŒè¯æ‰€æœ‰18ä¸ªæœåŠ¡æ­£ç¡®åˆå§‹åŒ–
- âœ… éªŒè¯ä¾èµ–æ³¨å…¥æ­£ç¡®å·¥ä½œ
- âœ… éªŒè¯å¾ªç¯ä¾èµ–æ­£ç¡®è§£å†³
- âœ… éªŒè¯åŠŸèƒ½æ–¹æ³•æ­£å¸¸å·¥ä½œ

**å®ŒæˆçŠ¶æ€**:
- âœ… æœåŠ¡æ³¨å†Œé…ç½®å®Œæˆ
- âœ… æœåŠ¡å®¹å™¨æ›´æ–°å®Œæˆ
- âœ… ä¾èµ–æ³¨å…¥ä¿®æ­£å®Œæˆ
- âœ… å¾ªç¯ä¾èµ–è§£å†³å®Œæˆ
- âœ… æµ‹è¯•éªŒè¯å…¨éƒ¨é€šè¿‡

---

## ğŸ§ª ç¬¬å…«é˜¶æ®µï¼šæµ‹è¯•å’ŒéªŒè¯

### ğŸ”¨ 8.1 åˆ›å»ºæµ‹è¯•æ–‡ä»¶

**æ–°å¢æµ‹è¯•ç›®å½•**: `tests/file-analysis/`
```
tests/file-analysis/
â”œâ”€â”€ FileAnalysisModule.test.js
â”œâ”€â”€ PreciseTokenCalculator.test.js
â”œâ”€â”€ BatchStrategies.test.js
â””â”€â”€ integration/
    â”œâ”€â”€ Step3Workflow.test.js
    â”œâ”€â”€ TaskManagement.test.js
    â””â”€â”€ EndToEndFlow.test.js
```

**æµ‹è¯•è¦†ç›–èŒƒå›´**:
- æ–‡ä»¶åˆ†ææ¨¡å—çš„å„ç§ç­–ç•¥
- Tokenè®¡ç®—çš„å‡†ç¡®æ€§
- æ‰¹æ¬¡åˆ†é…çš„åˆç†æ€§
- éªŒè¯æœºåˆ¶çš„æ­£ç¡®æ€§
- ç«¯åˆ°ç«¯å·¥ä½œæµç¨‹æµ‹è¯•

### ğŸ”¨ 8.2 åˆ›å»ºéªŒè¯è„šæœ¬

**æ–°å¢éªŒè¯è„šæœ¬**: `scripts/validate-refactoring.js`

**éªŒè¯å†…å®¹**:
- æ‰€æœ‰æ–°æ¨¡å—çš„åŠŸèƒ½å®Œæ•´æ€§
- ä¸ç°æœ‰ä»£ç çš„å…¼å®¹æ€§
- æ€§èƒ½å¯¹æ¯”ï¼ˆé‡æ„å‰åï¼‰
- é”™è¯¯å¤„ç†çš„å¥å£®æ€§

---

## ğŸ“š ç¬¬ä¹é˜¶æ®µï¼šæ–‡æ¡£å’Œé…ç½®æ›´æ–°

### ğŸ”¨ 9.1 æ›´æ–°é…ç½®æ–‡ä»¶

**éœ€è¦ä¿®æ”¹çš„é…ç½®**:
- `config/mcp.config.json` - æ–°å¢æ–‡ä»¶åˆ†ææ¨¡å—é…ç½®
- `config/modes.config.json` - æ›´æ–°å·¥ä½œæ¨¡å¼å®šä¹‰
- `config/templates.config.json` - é€‚é…æ–°çš„æ‰¹æ¬¡ç­–ç•¥

### ğŸ”¨ 9.2 æ›´æ–°é¡¹ç›®æ–‡æ¡£

**éœ€è¦æ›´æ–°çš„æ–‡æ¡£**:
- `README.md` - åæ˜ æ–°çš„æ¶æ„å’ŒåŠŸèƒ½
- `CLAUDE.md` - æ›´æ–°å¼€å‘æŒ‡å—
- APIæ–‡æ¡£ - æ›´æ–°MCPå·¥å…·æ¥å£è¯´æ˜

---

## ğŸš€ ç¬¬åé˜¶æ®µï¼šéƒ¨ç½²å’Œå›å½’æµ‹è¯•

### ğŸ”¨ 10.1 æ¸è¿›å¼éƒ¨ç½²ç­–ç•¥

**éƒ¨ç½²æ­¥éª¤**:
1. **å¼€å‘ç¯å¢ƒéªŒè¯** - å®Œæ•´åŠŸèƒ½æµ‹è¯•
2. **å…¼å®¹æ€§æµ‹è¯•** - ç¡®ä¿å‘ä¸‹å…¼å®¹
3. **æ€§èƒ½æµ‹è¯•** - å¯¹æ¯”é‡æ„å‰åæ€§èƒ½
4. **ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²** - è°¨æ…çš„ç”Ÿäº§éƒ¨ç½²

### ğŸ”¨ 10.2 å›å½’æµ‹è¯•è®¡åˆ’

**æµ‹è¯•èŒƒå›´**:
- æ‰€æœ‰åŸæœ‰åŠŸèƒ½æ­£å¸¸å·¥ä½œ
- æ–°åŠŸèƒ½æŒ‰è®¾è®¡å·¥ä½œ
- è¾¹ç•Œæƒ…å†µå¤„ç†æ­£ç¡®
- é”™è¯¯æ¢å¤æœºåˆ¶æœ‰æ•ˆ

---

## ğŸ“Š é¢„æœŸå½±å“è¯„ä¼°

### âœ… æ­£é¢å½±å“
- **Tokenæ•ˆç‡æå‡ 30%+** - ç²¾ç¡®è®¡ç®—å’Œæ™ºèƒ½åˆ†é…
- **é”™è¯¯ç‡é™ä½ 50%+** - ç®€åŒ–éªŒè¯å’Œè‡ªåŠ¨å®Œæˆ
- **å¼€å‘ä½“éªŒæ”¹å–„** - ç»Ÿä¸€ä»»åŠ¡ç®¡ç†å’Œæ¸…æ™°æµç¨‹
- **ç³»ç»Ÿç¨³å®šæ€§æå‡** - åˆ†å±‚æ¶æ„å’Œé”™è¯¯å¤„ç†

### âš ï¸ é£é™©æ§åˆ¶
- **å‘ä¸‹å…¼å®¹æ€§** - ä¿æŒç°æœ‰APIæ¥å£ç¨³å®š
- **æ¸è¿›å¼è¿ç§»** - åˆ†é˜¶æ®µå®æ–½ï¼Œé™ä½é£é™©
- **å›æ»šæ–¹æ¡ˆ** - å®Œæ•´çš„ä»£ç å¤‡ä»½å’Œå›æ»šç­–ç•¥
- **ç›‘æ§æœºåˆ¶** - å®æ—¶ç›‘æ§æ–°åŠŸèƒ½çš„è¿è¡ŒçŠ¶æ€

---

## ğŸ¯ å®æ–½ä¼˜å…ˆçº§

### ğŸ”¥ é«˜ä¼˜å…ˆçº§ï¼ˆå¿…é¡»å®ç°ï¼‰
1. FileAnalysisModule æ ¸å¿ƒåŠŸèƒ½
2. UnifiedTaskValidator.js éªŒè¯æœºåˆ¶
3. Step3 éªŒè¯æµç¨‹é‡æ„
4. ä¸‰ç§æ‰¹æ¬¡ç­–ç•¥å®ç°

### ğŸ”¶ ä¸­ä¼˜å…ˆçº§ï¼ˆé‡è¦åŠŸèƒ½ï¼‰
5. UnifiedTaskManager æ‰©å±•
6. Step4-6 ç»Ÿä¸€ä»»åŠ¡ç®¡ç†
7. MCPå·¥å…·æ¥å£æ›´æ–°
8. æœåŠ¡æ³¨å†Œå’Œé›†æˆ

### ğŸ”µ ä½ä¼˜å…ˆçº§ï¼ˆä¼˜åŒ–åŠŸèƒ½ï¼‰
9. æ€§èƒ½ä¼˜åŒ–å’Œç¼“å­˜
10. å…¨é¢æµ‹è¯•è¦†ç›–
11. æ–‡æ¡£å’Œé…ç½®æ›´æ–°
12. ç›‘æ§å’Œæ—¥å¿—å¢å¼º

---

## ğŸ“‹ æ€»ç»“

è¿™ä¸ªé‡æ„è®¡åˆ’æ¶µç›–äº†ä»æ¶æ„è®¾è®¡åˆ°å…·ä½“å®æ–½çš„æ‰€æœ‰ç»†èŠ‚ã€‚æ ¸å¿ƒæ˜¯å¼•å…¥FileAnalysisModuleä½œä¸ºæ™ºèƒ½å¤§è„‘ï¼Œå®ç°åˆ†å±‚éªŒè¯ç­–ç•¥ï¼Œå¹¶å°†ç»Ÿä¸€ä»»åŠ¡ç®¡ç†æ‰©å±•åˆ°å…¨éƒ¨6ä¸ªæ­¥éª¤ã€‚

**å…³é”®æˆåŠŸå› ç´ **:
- ä¸¥æ ¼æŒ‰ç…§è®¾è®¡æ–‡æ¡£å®æ–½
- ä¿æŒä»£ç è´¨é‡å’Œæµ‹è¯•è¦†ç›–
- æ¸è¿›å¼éƒ¨ç½²ï¼Œé™ä½é£é™©
- æŒç»­ç›‘æ§å’Œä¼˜åŒ–

é€šè¿‡è¿™ä¸ªè®¡åˆ’ï¼Œmg_kiro MCP Serverå°†å®ç°æ›´æ™ºèƒ½çš„æ–‡ä»¶å¤„ç†ã€æ›´ç²¾ç¡®çš„Tokenç®¡ç†å’Œæ›´ç»Ÿä¸€çš„ä»»åŠ¡æµç¨‹ã€‚