# 集成契约 - {{project_name}}

## API规范
- **基础URL**: `{{base_url}}/api/v{{api_version}}`
- **认证方式**: {{auth_method}}
- **内容类型**: `application/json`

## 状态码
| 代码 | 含义 |
|------|------|
| 200 | 请求成功 |
| 201 | 资源创建成功 |
| 400 | 请求参数错误 |
| 401 | 未认证 |
| 403 | 无权限 |
| 404 | 资源不存在 |
| 500 | 服务器错误 |

## 核心接口
### {{api_endpoint_1}}
- **路径**: `{{api_path_1}}`
- **方法**: `{{api_method_1}}`
- **认证**: {{api_auth_1}}

**请求**:
```json
{
  "{{request_field1}}": "{{value1}}",
  "{{request_field2}}": "{{value2}}"
}
```

**响应**:
```json
{
  "code": 200,
  "data": {
    "{{response_field1}}": "{{value1}}",
    "{{response_field2}}": "{{value2}}"
  }
}
```

## SLA指标
| 接口类别 | 响应时间 | 可用性 | QPS |
|---------|---------|--------|-----|
| 查询接口 | < 100ms | 99.9% | 10000 |
| 写入接口 | < 200ms | 99.9% | 5000 |

## 版本管理
- **格式**: `v{major}.{minor}`
- **兼容性**: 保持向后兼容
- **升级**: 提前通知客户端

## 🔄 集成契约流程图

### API请求处理流程
```mermaid
sequenceDiagram
    participant C as 客户端
    participant G as 网关
    participant A as API服务
    participant D as 数据库
    participant L as 日志服务
    
    C->>G: 1. 发送API请求
    G->>G: 2. 认证验证
    alt 认证失败
        G-->>C: 返回401错误
    else 认证成功
        G->>A: 3. 转发请求
        A->>A: 4. 参数验证
        alt 参数错误
            A-->>G: 返回400错误
            G-->>C: 转发错误响应
        else 参数正确
            A->>D: 5. 数据操作
            D-->>A: 6. 返回数据
            A->>L: 7. 记录日志
            A-->>G: 8. 返回响应
            G-->>C: 9. 转发响应
        end
    end
```

### 服务集成协议流程
```mermaid
graph TD
    A[定义服务接口] --> B[制定数据格式]
    B --> C[确定通信协议]
    C --> D[设计错误处理]
    D --> E[制定SLA指标]
    
    E --> F[编写接口文档]
    F --> G[生成客户端SDK]
    G --> H[部署测试环境]
    H --> I[集成测试]
    
    I --> J{测试结果}
    J -->|通过| K[发布生产版本]
    J -->|失败| L[问题分析]
    L --> M[修复问题]
    M --> I
    
    K --> N[监控运行状态]
    N --> O[收集性能指标]
    O --> P[持续优化]
    
    subgraph "版本演进"
        Q[v1.0版本]
        R[v1.1版本]
        S[v2.0版本]
    end
    
    P --> Q
    Q --> R
    R --> S
```

### 契约变更管理流程
```mermaid
stateDiagram-v2
    [*] --> 契约设计
    契约设计 --> 内部评审
    内部评审 --> 外部沟通: 评审通过
    内部评审 --> 契约设计: 需要修改
    
    外部沟通 --> 影响评估
    影响评估 --> 兼容性检查
    兼容性检查 --> 向后兼容: 兼容
    兼容性检查 --> 重大变更: 不兼容
    
    向后兼容 --> 灰度发布
    重大变更 --> 迁移计划
    迁移计划 --> 客户端通知
    客户端通知 --> 并行运行
    并行运行 --> 逐步切换
    
    灰度发布 --> 全量发布
    逐步切换 --> 全量发布
    全量发布 --> 监控反馈
    监控反馈 --> 契约稳定
    契约稳定 --> [*]
    
    监控反馈 --> 问题修复: 发现问题
    问题修复 --> 灰度发布
```

### 错误处理决策树
```mermaid
flowchart TD
    A[收到错误] --> B{错误类型}
    
    B -->|客户端错误 4xx| C[分析请求参数]
    B -->|服务端错误 5xx| D[检查服务状态]
    B -->|网络错误| E[检查网络连接]
    
    C --> F{参数问题}
    F -->|格式错误| G[返回400 Bad Request]
    F -->|认证失败| H[返回401 Unauthorized]
    F -->|权限不足| I[返回403 Forbidden]
    F -->|资源不存在| J[返回404 Not Found]
    
    D --> K{服务状态}
    K -->|服务正常| L[返回500 Internal Error]
    K -->|服务繁忙| M[返回503 Service Unavailable]
    K -->|数据库问题| N[返回502 Bad Gateway]
    
    E --> O[返回网络超时错误]
    
    G --> P[记录错误日志]
    H --> P
    I --> P
    J --> P
    L --> P
    M --> P
    N --> P
    O --> P
    
    P --> Q[发送告警通知]
    Q --> R[更新错误统计]
```