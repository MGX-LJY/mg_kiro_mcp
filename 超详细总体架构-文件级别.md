# ğŸ—ï¸ mg_kiro MCPæœåŠ¡å™¨ - è¶…è¯¦ç»†æ€»ä½“æ¶æ„ï¼ˆç²¾ç¡®åˆ°æ–‡ä»¶çº§åˆ«ï¼‰

## ğŸ“Š å®Œæ•´æ–‡ä»¶ä¾èµ–å…³ç³»å›¾

```mermaid
graph TB
    %% =================================
    %% å…¥å£å±‚ - ä¸»å…¥å£ç‚¹
    %% =================================
    subgraph "ğŸ“ ROOT"
        INDEX[index.js<br/>ğŸ¯ ä¸»å…¥å£ç‚¹<br/>MCP + Express + WebSocket]
        PACKAGE[package.json<br/>ğŸ“¦ é¡¹ç›®é…ç½®]
        JEST[jest.config.js<br/>ğŸ§ª æµ‹è¯•é…ç½®]
    end
    
    %% =================================
    %% å¤–éƒ¨ä¾èµ–å±‚
    %% =================================
    subgraph "ğŸŒ External Dependencies"
        MCP_SDK["@modelcontextprotocol/sdk<br/>Server, StdioServerTransport"]
        EXPRESS["express<br/>Webæ¡†æ¶"]
        WS["ws<br/>WebSocket"]
        CORS["cors<br/>è·¨åŸŸå¤„ç†"]
        FS["fs<br/>æ–‡ä»¶ç³»ç»Ÿ"]
        PATH["path<br/>è·¯å¾„å¤„ç†"]
        CRYPTO["crypto<br/>åŠ å¯†å·¥å…·"]
    end
    
    %% =================================
    %% è·¯ç”±å±‚ - è¯·æ±‚åˆ†å‘
    %% =================================
    subgraph "ğŸ—‚ï¸ server/routes/"
        ROUTES_INDEX[routes/index.js<br/>ğŸ­ ä¸»è·¯ç”±å…¥å£<br/>è·¯ç”±èšåˆå’Œé”™è¯¯å¤„ç†]
        
        %% ç³»ç»Ÿè·¯ç”±å­æ¨¡å—
        subgraph "ğŸ”§ routes/system/"
            HEALTH[system/health.js<br/>ğŸ’“ å¥åº·æ£€æŸ¥è·¯ç”±<br/>æœåŠ¡çŠ¶æ€ç›‘æ§]
            MCP_ROUTE[system/mcp.js<br/>ğŸ”Œ MCPåè®®è·¯ç”±<br/>åè®®ç®¡ç†ç«¯ç‚¹]
            PROMPTS[system/prompts.js<br/>ğŸ“ æç¤ºè¯ç®¡ç†è·¯ç”±<br/>æ¨¡æ¿CRUDæ“ä½œ]
            SYSTEM_INDEX[system/index.js<br/>ğŸ”— ç³»ç»Ÿè·¯ç”±èšåˆå™¨]
        end
        
        %% Initè·¯ç”±å­æ¨¡å—  
        subgraph "ğŸš€ routes/init/"
            CLAUDE_INIT[init/claude-code-init.js<br/>ğŸ¯ Claude Codeä¸“ç”¨Init<br/>6æ­¥å·¥ä½œæµè·¯ç”±]
            TURBO_INIT[init/turbo-init.js<br/>âš¡ é«˜æ€§èƒ½Turbo Init<br/>æ‰¹é‡å¤„ç†è·¯ç”±] 
            AI_BATCH_INIT[init/ai-batch-init.js<br/>ğŸ¤– AIæ‰¹å¤„ç†Init<br/>æ™ºèƒ½åˆ†æè·¯ç”±]
        end
        
        %% Createè·¯ç”±å­æ¨¡å—
        subgraph "âš’ï¸ routes/create/"
            CREATE_INDEX[create/index.js<br/>ğŸ—ï¸ Createæ¨¡å¼ä¸»è·¯ç”±<br/>åŠŸèƒ½åˆ›å»ºå…¥å£]
            EXISTING_PROJ[create/existing-project-workflow.js<br/>ğŸ“ ç°æœ‰é¡¹ç›®å·¥ä½œæµ<br/>é¡¹ç›®å¢å¼ºè·¯ç”±]
            NEW_PROJ[create/new-project-workflow.js<br/>ğŸ†• æ–°é¡¹ç›®å·¥ä½œæµ<br/>é¡¹ç›®åˆ›å»ºè·¯ç”±]
        end
    end
    
    %% =================================
    %% æœåŠ¡ç®¡ç†å±‚ - æ ¸å¿ƒåŸºç¡€è®¾æ–½
    %% =================================
    subgraph "âš™ï¸ server/services/ - æœåŠ¡ç®¡ç†"
        SERVICE_BUS[service-bus.js<br/>ğŸšŒ æœåŠ¡æ€»çº¿<br/>ä¾èµ–æ³¨å…¥å®¹å™¨<br/>å¾ªç¯ä¾èµ–è§£å†³<br/>ç”Ÿå‘½å‘¨æœŸç®¡ç†]
        SERVICE_REGISTRY[service-registry.js<br/>ğŸ“‹ æœåŠ¡æ³¨å†Œè¡¨<br/>æœåŠ¡å®šä¹‰æ³¨å†Œ<br/>ä¾èµ–å…³ç³»é…ç½®<br/>æ‰¹é‡åˆå§‹åŒ–]
        RESPONSE_SERVICE[response-service.js<br/>ğŸ“¤ å“åº”æœåŠ¡<br/>ç»Ÿä¸€å“åº”æ ¼å¼<br/>é”™è¯¯å¤„ç†]
        CONFIG_SERVICE[config-service.js<br/>âš™ï¸ é…ç½®æœåŠ¡<br/>é…ç½®æ–‡ä»¶ç®¡ç†<br/>ç¯å¢ƒå˜é‡å¤„ç†]
    end
    
    %% =================================
    %% æ ¸å¿ƒä¸šåŠ¡æœåŠ¡å±‚
    %% =================================
    subgraph "ğŸ§  server/services/ - æ ¸å¿ƒæœåŠ¡"
        %% AIå’Œç›‘æ§æœåŠ¡
        AI_TODO[ai-todo-manager.js<br/>ğŸ¤– AIä»»åŠ¡ç®¡ç†å™¨<br/>æ™ºèƒ½ä»»åŠ¡ç”Ÿæˆ<br/>ä¼˜å…ˆçº§æ’åº]
        MONITOR[complete-task-monitor.js<br/>ğŸ‘ï¸ ä»»åŠ¡å®Œæˆç›‘æ§å™¨<br/>çŠ¶æ€è·Ÿè¸ª<br/>å®ŒæˆéªŒè¯]
        
        %% å†…å®¹å¤„ç†æœåŠ¡
        OVERVIEW_GEN[project-overview-generator.js<br/>ğŸ“Š é¡¹ç›®æ¦‚è§ˆç”Ÿæˆå™¨<br/>ç»“æ„æ‰«æ<br/>å…ƒæ•°æ®æå–]
        FILE_QUERY[file-query-service.js<br/>ğŸ” æ–‡ä»¶æŸ¥è¯¢æœåŠ¡<br/>å†…å®¹æ£€ç´¢<br/>æ™ºèƒ½æœç´¢]
        CONTENT_TRIM[smart-content-trimmer.js<br/>âœ‚ï¸ æ™ºèƒ½å†…å®¹ä¿®å‰ªå™¨<br/>Tokenä¼˜åŒ–<br/>å†…å®¹å‹ç¼©]
        LANG_INTEL[language-intelligence-service.js<br/>ğŸ§  è¯­è¨€æ™ºèƒ½æœåŠ¡<br/>ä¸Šä¸‹æ–‡åˆ†æ<br/>æ™ºèƒ½æç¤ºç”Ÿæˆ]
    end
    
    %% =================================
    %% ç»Ÿä¸€æ¨¡æ¿ç³»ç»Ÿ
    %% =================================
    subgraph "ğŸ“‹ server/services/unified/ - æ¨¡æ¿ç³»ç»Ÿ"
        MASTER_TEMPLATE[master-template-service.js<br/>ğŸ­ ç»Ÿä¸€æ¨¡æ¿æœåŠ¡<br/>æ¨¡æ¿é€‰æ‹©ç­–ç•¥<br/>å˜é‡å¤„ç†<br/>ç¼“å­˜ç®¡ç†<br/>å¤šæ–‡æ¡£æ”¯æŒ]
        TEMPLATE_CONFIG[template-config-manager.js<br/>âš™ï¸ æ¨¡æ¿é…ç½®ç®¡ç†å™¨<br/>é…ç½®åŠ è½½<br/>æ¨¡æ¿æ˜ å°„<br/>ç¼“å­˜æ§åˆ¶]
        MODE_TEMPLATE[mode-template-service.js<br/>ğŸ¨ æ¨¡å¼æ¨¡æ¿æœåŠ¡<br/>å·¥ä½œæ¨¡å¼é€‚é…<br/>æ™ºèƒ½é€‰æ‹©<br/>è¯­è¨€ç‰¹åŒ–]
    end
    
    %% =================================  
    %% è¯­è¨€å¤„ç†æ¨¡å—
    %% =================================
    subgraph "ğŸŒ server/language/ - è¯­è¨€å¤„ç†"
        DETECTOR[detector.js<br/>ğŸ” è¯­è¨€æ£€æµ‹å™¨<br/>æ™ºèƒ½æ£€æµ‹ç®—æ³•<br/>é¡¹ç›®ç±»å‹è¯†åˆ«<br/>æ¡†æ¶ç‰¹å¾åˆ†æ]
        PROMPT_INTEL[prompt-intelligence.js<br/>ğŸ§  æç¤ºè¯æ™ºèƒ½<br/>ä¸Šä¸‹æ–‡ç”Ÿæˆ<br/>è¯­è¨€ä¼˜åŒ–<br/>æ™ºèƒ½å»ºè®®]
    end
    
    %% =================================
    %% æ–‡ä»¶åˆ†ææ¨¡å— - AIå¤§è„‘
    %% =================================
    subgraph "ğŸ”¬ server/services/file-analysis/ - æ–‡ä»¶åˆ†ææ¨¡å—"
        FILE_ANALYSIS[FileAnalysisModule.js<br/>ğŸ§  æ–‡ä»¶åˆ†ææ¨¡å—<br/>ç³»ç»Ÿåè°ƒå¤§è„‘<br/>æ‰¹æ¬¡è§„åˆ’<br/>ç­–ç•¥åˆ†é…]
        
        %% Tokenåˆ†æå­æ¨¡å—
        subgraph "ğŸ”¢ file-analysis/token-analysis/"
            TOKEN_CALC[PreciseTokenCalculator.js<br/>âš–ï¸ ç²¾ç¡®Tokenè®¡ç®—å™¨<br/>å¤šè¯­è¨€æ”¯æŒ<br/>ç²¾ç¡®ä¼°ç®—<br/>æ‰¹æ¬¡ä¼˜åŒ–]
            BOUNDARY_DET[FunctionBoundaryDetector.js<br/>ğŸ¯ å‡½æ•°è¾¹ç•Œæ£€æµ‹å™¨<br/>ä»£ç ç»“æ„åˆ†æ<br/>æ™ºèƒ½åˆ†å‰²ç‚¹<br/>ä¸Šä¸‹æ–‡ä¿æŠ¤]
        end
        
        %% æ‰¹æ¬¡ç­–ç•¥å­æ¨¡å—
        subgraph "ğŸ“¦ file-analysis/batch-strategies/"
            COMBINED_BATCH[CombinedFileBatchStrategy.js<br/>ğŸ”— ç»¼åˆæ–‡ä»¶æ‰¹æ¬¡ç­–ç•¥<br/>å°æ–‡ä»¶ç»„åˆ<br/>Tokenä¼˜åŒ–<br/>æ•ˆç‡æœ€å¤§åŒ–]
            SINGLE_BATCH[SingleFileBatchStrategy.js<br/>ğŸ“„ å•æ–‡ä»¶æ‰¹æ¬¡ç­–ç•¥<br/>ä¸­ç­‰æ–‡ä»¶å¤„ç†<br/>è´¨é‡ä¿è¯<br/>ç‹¬ç«‹åˆ†æ]
            LARGE_MULTI[LargeFileMultiBatchStrategy.js<br/>ğŸ—‚ï¸ å¤§æ–‡ä»¶å¤šæ‰¹æ¬¡ç­–ç•¥<br/>æ™ºèƒ½åˆ†å‰²<br/>è¾¹ç•Œä¿æŠ¤<br/>ä¸Šä¸‹æ–‡ç»´æŠ¤]
        end
    end
    
    %% =================================
    %% ä»»åŠ¡ç®¡ç†æ¨¡å— - å·¥ä½œæµå¼•æ“  
    %% =================================
    subgraph "ğŸ“‹ server/services/task-management/ - ä»»åŠ¡ç®¡ç†"
        TASK_MANAGER[UnifiedTaskManager.js<br/>ğŸ­ ç»Ÿä¸€ä»»åŠ¡ç®¡ç†å™¨<br/>ä»»åŠ¡ç”Ÿå‘½å‘¨æœŸ<br/>çŠ¶æ€åè°ƒ<br/>æµç¨‹ç¼–æ’]
        TASK_STATE[TaskStateManager.js<br/>ğŸ“Š ä»»åŠ¡çŠ¶æ€ç®¡ç†å™¨<br/>çŠ¶æ€æŒä¹…åŒ–<br/>è¿›åº¦è¿½è¸ª<br/>å†å²è®°å½•]
        TASK_VALIDATOR[UnifiedTaskValidator.js<br/>âœ… ç»Ÿä¸€ä»»åŠ¡éªŒè¯å™¨<br/>å®ŒæˆéªŒè¯<br/>è´¨é‡æ£€æŸ¥<br/>ä¾èµ–éªŒè¯]
        
        %% éªŒè¯ç­–ç•¥å­æ¨¡å—
        subgraph "ğŸ” task-management/validation-strategies/"
            STEP3_VAL[Step3FolderValidator.js<br/>ğŸ“ Step3æ–‡ä»¶å¤¹éªŒè¯å™¨<br/>æ–‡ä»¶å­˜åœ¨æ€§æ£€æŸ¥<br/>ç»“æ„éªŒè¯]
            STEP4_VAL[Step4ModuleValidator.js<br/>ğŸ“¦ Step4æ¨¡å—éªŒè¯å™¨<br/>æ¨¡å—å®Œæ•´æ€§<br/>æ•´åˆéªŒè¯]
            STEP5_VAL[Step5FixedFileValidator.js<br/>ğŸ“„ Step5å›ºå®šæ–‡ä»¶éªŒè¯å™¨<br/>å…³ç³»æ–‡ä»¶æ£€æŸ¥<br/>ä¾èµ–éªŒè¯]
            STEP6_VAL[Step6ArchitectureValidator.js<br/>ğŸ—ï¸ Step6æ¶æ„éªŒè¯å™¨<br/>æ¶æ„æ–‡æ¡£æ£€æŸ¥<br/>å®ŒæˆéªŒè¯]
        end
    end
    
    %% =================================
    %% é…ç½®ç®¡ç†å±‚
    %% =================================
    subgraph "âš™ï¸ config/ - é…ç½®æ–‡ä»¶"
        MCP_CONFIG[mcp.config.json<br/>ğŸ”Œ MCPæœåŠ¡å™¨é…ç½®<br/>åè®®å‚æ•°<br/>è¿æ¥è®¾ç½®]
        MODES_CONFIG[modes.config.json<br/>ğŸ­ å·¥ä½œæ¨¡å¼é…ç½®<br/>Init/Createæ¨¡å¼<br/>å‚æ•°è®¾å®š]
        TEMPLATE_SYS_CONFIG[template-system.config.json<br/>ğŸ“‹ æ¨¡æ¿ç³»ç»Ÿé…ç½®<br/>æ¨¡æ¿è·¯å¾„<br/>ç¼“å­˜è®¾ç½®]
        TEMPLATES_CONFIG[templates.config.json<br/>ğŸ“ æ¨¡æ¿æ˜ å°„é…ç½®<br/>æ¨¡æ¿å…³ç³»<br/>åˆ«åå®šä¹‰]
        WORKFLOWS_CONFIG[workflows.config.json<br/>ğŸ”„ å·¥ä½œæµé…ç½®<br/>æ­¥éª¤å®šä¹‰<br/>æµç¨‹å‚æ•°]
    end
    
    %% =================================
    %% å·¥å…·å’Œè„šæœ¬
    %% =================================
    subgraph "ğŸ› ï¸ scripts/ - å·¥å…·è„šæœ¬"
        TEST_REGISTRY[test-service-registry.js<br/>ğŸ§ª æœåŠ¡æ³¨å†Œè¡¨æµ‹è¯•<br/>ä¾èµ–éªŒè¯<br/>åˆå§‹åŒ–æµ‹è¯•]
    end
    
    %% =================================
    %% ä¸»è¦ä¾èµ–å…³ç³» - å…¥å£å±‚
    %% =================================
    INDEX --> EXPRESS
    INDEX --> MCP_SDK 
    INDEX --> WS
    INDEX --> CORS
    INDEX --> FS
    INDEX --> PATH
    INDEX --> ROUTES_INDEX
    INDEX --> SERVICE_REGISTRY
    
    %% =================================
    %% æœåŠ¡ç®¡ç†ä¾èµ–
    %% =================================
    SERVICE_REGISTRY --> SERVICE_BUS
    SERVICE_REGISTRY --> CONFIG_SERVICE
    SERVICE_REGISTRY --> AI_TODO
    SERVICE_REGISTRY --> MONITOR
    SERVICE_REGISTRY --> DETECTOR
    SERVICE_REGISTRY --> LANG_INTEL
    SERVICE_REGISTRY --> OVERVIEW_GEN
    SERVICE_REGISTRY --> FILE_QUERY
    SERVICE_REGISTRY --> CONTENT_TRIM
    SERVICE_REGISTRY --> MASTER_TEMPLATE
    SERVICE_REGISTRY --> TEMPLATE_CONFIG
    SERVICE_REGISTRY --> MODE_TEMPLATE
    SERVICE_REGISTRY --> FILE_ANALYSIS
    SERVICE_REGISTRY --> TOKEN_CALC
    SERVICE_REGISTRY --> COMBINED_BATCH
    SERVICE_REGISTRY --> SINGLE_BATCH
    SERVICE_REGISTRY --> LARGE_MULTI
    SERVICE_REGISTRY --> TASK_MANAGER
    SERVICE_REGISTRY --> TASK_VALIDATOR
    SERVICE_REGISTRY --> TASK_STATE
    
    %% =================================
    %% è·¯ç”±ç³»ç»Ÿä¾èµ–
    %% =================================
    ROUTES_INDEX --> HEALTH
    ROUTES_INDEX --> MCP_ROUTE
    ROUTES_INDEX --> PROMPTS
    ROUTES_INDEX --> CLAUDE_INIT
    ROUTES_INDEX --> TURBO_INIT
    ROUTES_INDEX --> AI_BATCH_INIT
    ROUTES_INDEX --> CREATE_INDEX
    
    SYSTEM_INDEX --> HEALTH
    SYSTEM_INDEX --> MCP_ROUTE
    SYSTEM_INDEX --> PROMPTS
    
    CREATE_INDEX --> EXISTING_PROJ
    CREATE_INDEX --> NEW_PROJ
    
    %% è·¯ç”±åˆ°æœåŠ¡çš„ä¾èµ–
    HEALTH --> RESPONSE_SERVICE
    MCP_ROUTE --> RESPONSE_SERVICE
    PROMPTS --> RESPONSE_SERVICE
    PROMPTS --> MASTER_TEMPLATE
    PROMPTS --> TEMPLATE_CONFIG
    PROMPTS --> MODE_TEMPLATE
    CLAUDE_INIT --> RESPONSE_SERVICE
    CLAUDE_INIT --> OVERVIEW_GEN
    CLAUDE_INIT --> AI_TODO
    CLAUDE_INIT --> FILE_QUERY
    TURBO_INIT --> RESPONSE_SERVICE
    AI_BATCH_INIT --> RESPONSE_SERVICE
    CREATE_INDEX --> RESPONSE_SERVICE
    EXISTING_PROJ --> RESPONSE_SERVICE
    NEW_PROJ --> RESPONSE_SERVICE
    
    %% =================================
    %% æ ¸å¿ƒæœåŠ¡é—´ä¾èµ– - å¾ªç¯ä¾èµ–
    %% =================================
    LANG_INTEL -.->|å¾ªç¯ä¾èµ–| MASTER_TEMPLATE
    MASTER_TEMPLATE -.->|å¾ªç¯ä¾èµ–| LANG_INTEL
    LANG_INTEL --> DETECTOR
    LANG_INTEL --> PROMPT_INTEL
    LANG_INTEL --> TEMPLATE_CONFIG
    
    MASTER_TEMPLATE --> CRYPTO
    MASTER_TEMPLATE --> FS
    MASTER_TEMPLATE --> PATH
    
    OVERVIEW_GEN --> DETECTOR
    OVERVIEW_GEN --> MASTER_TEMPLATE
    OVERVIEW_GEN --> TEMPLATE_CONFIG
    
    FILE_QUERY --> CONTENT_TRIM
    
    %% =================================
    %% è¯­è¨€å¤„ç†ä¾èµ–
    %% =================================
    PROMPT_INTEL --> DETECTOR
    
    %% =================================
    %% æ–‡ä»¶åˆ†ææ¨¡å—ä¾èµ–
    %% =================================
    FILE_ANALYSIS --> TOKEN_CALC
    FILE_ANALYSIS --> COMBINED_BATCH
    FILE_ANALYSIS --> SINGLE_BATCH
    FILE_ANALYSIS --> LARGE_MULTI
    
    LARGE_MULTI --> BOUNDARY_DET
    
    %% =================================
    %% ä»»åŠ¡ç®¡ç†ä¾èµ–
    %% =================================
    TASK_MANAGER --> TASK_STATE
    TASK_MANAGER --> TASK_VALIDATOR
    
    TASK_VALIDATOR --> FILE_ANALYSIS
    TASK_VALIDATOR --> TASK_STATE
    TASK_VALIDATOR --> STEP3_VAL
    TASK_VALIDATOR --> STEP4_VAL
    TASK_VALIDATOR --> STEP5_VAL
    TASK_VALIDATOR --> STEP6_VAL
    
    %% =================================
    %% å·¥å…·è„šæœ¬ä¾èµ–
    %% =================================
    TEST_REGISTRY --> SERVICE_REGISTRY
    
    %% =================================
    %% é…ç½®æ–‡ä»¶ä¾èµ–
    %% =================================
    CONFIG_SERVICE --> MCP_CONFIG
    CONFIG_SERVICE --> MODES_CONFIG
    CONFIG_SERVICE --> TEMPLATE_SYS_CONFIG
    CONFIG_SERVICE --> TEMPLATES_CONFIG
    CONFIG_SERVICE --> WORKFLOWS_CONFIG
    
    %% =================================
    %% æ ·å¼å®šä¹‰
    %% =================================
    classDef entryPoint fill:#ff6b6b,stroke:#c92a2a,stroke-width:3px,color:#fff
    classDef serviceCore fill:#4ecdc4,stroke:#339c92,stroke-width:2px,color:#fff
    classDef routeLayer fill:#45b7d1,stroke:#2980b9,stroke-width:2px,color:#fff
    classDef configLayer fill:#f39c12,stroke:#d68910,stroke-width:2px,color:#fff
    classDef analysisLayer fill:#9b59b6,stroke:#7d3c98,stroke-width:2px,color:#fff
    classDef templateLayer fill:#2ecc71,stroke:#27ae60,stroke-width:2px,color:#fff
    classDef taskLayer fill:#e74c3c,stroke:#c0392b,stroke-width:2px,color:#fff
    classDef external fill:#95a5a6,stroke:#7f8c8d,stroke-width:1px,color:#fff
    
    %% åº”ç”¨æ ·å¼
    class INDEX entryPoint
    class SERVICE_BUS,SERVICE_REGISTRY,RESPONSE_SERVICE,CONFIG_SERVICE serviceCore
    class ROUTES_INDEX,HEALTH,MCP_ROUTE,PROMPTS,SYSTEM_INDEX routeLayer
    class CLAUDE_INIT,TURBO_INIT,AI_BATCH_INIT routeLayer
    class CREATE_INDEX,EXISTING_PROJ,NEW_PROJ routeLayer
    class MCP_CONFIG,MODES_CONFIG,TEMPLATE_SYS_CONFIG,TEMPLATES_CONFIG,WORKFLOWS_CONFIG configLayer
    class FILE_ANALYSIS,TOKEN_CALC,BOUNDARY_DET,COMBINED_BATCH,SINGLE_BATCH,LARGE_MULTI analysisLayer
    class MASTER_TEMPLATE,TEMPLATE_CONFIG,MODE_TEMPLATE templateLayer
    class TASK_MANAGER,TASK_STATE,TASK_VALIDATOR,STEP3_VAL,STEP4_VAL,STEP5_VAL,STEP6_VAL taskLayer
    class MCP_SDK,EXPRESS,WS,CORS,FS,PATH,CRYPTO external
```

## ğŸ“‹ æ–‡ä»¶èŒè´£è¯¦ç»†åˆ†æ

### ğŸ¯ **å…¥å£å±‚æ–‡ä»¶ (1ä¸ª)**

| æ–‡ä»¶ | è¡Œæ•° | èŒè´£ | å…³é”®å¯¼å…¥ | å¯¼å‡ºå†…å®¹ |
|------|------|------|----------|----------|
| `index.js` | 1200+ | ç»Ÿä¸€å…¥å£ç‚¹ï¼ŒMCP+Express+WebSocketä¸‰åˆä¸€æœåŠ¡å™¨ | MCP SDK, express, ws, cors | startServer() |

### ğŸ—‚ï¸ **è·¯ç”±å±‚æ–‡ä»¶ (10ä¸ª)**

| æ–‡ä»¶ | èŒè´£ | å…³é”®ä¾èµ– | APIç«¯ç‚¹æ•° |
|------|------|----------|-----------|
| `routes/index.js` | ä¸»è·¯ç”±èšåˆå™¨ï¼Œé”™è¯¯å¤„ç†ï¼ŒæœåŠ¡æ³¨å…¥ | å„å­è·¯ç”±æ¨¡å— | 2ä¸ªç³»ç»Ÿç«¯ç‚¹ |
| `routes/system/health.js` | å¥åº·æ£€æŸ¥ï¼ŒæœåŠ¡çŠ¶æ€ç›‘æ§ | response-service | 1ä¸ª |
| `routes/system/mcp.js` | MCPåè®®ç®¡ç†ç«¯ç‚¹ | response-service | 3ä¸ª |
| `routes/system/prompts.js` | æç¤ºè¯ç®¡ç†CRUD | 3ä¸ªæ¨¡æ¿æœåŠ¡ | 8ä¸ª |
| `routes/system/index.js` | ç³»ç»Ÿè·¯ç”±èšåˆå™¨ | ç³»ç»Ÿå­è·¯ç”± | 0ä¸ª |
| `routes/init/claude-code-init.js` | Claude Code 6æ­¥Initå·¥ä½œæµ | 3ä¸ªæ ¸å¿ƒæœåŠ¡ | 10ä¸ª |
| `routes/init/turbo-init.js` | é«˜æ€§èƒ½æ‰¹é‡å¤„ç†è·¯ç”± | response-service | 5ä¸ª |
| `routes/init/ai-batch-init.js` | AIæ™ºèƒ½æ‰¹å¤„ç†è·¯ç”± | response-service | 6ä¸ª |
| `routes/create/index.js` | Createæ¨¡å¼ä¸»è·¯ç”± | 2ä¸ªå·¥ä½œæµè·¯ç”± | 4ä¸ª |
| `routes/create/existing-project-workflow.js` | ç°æœ‰é¡¹ç›®å¢å¼ºå·¥ä½œæµ | response-service | 6ä¸ª |
| `routes/create/new-project-workflow.js` | æ–°é¡¹ç›®åˆ›å»ºå·¥ä½œæµ | response-service | 7ä¸ª |

### âš™ï¸ **æœåŠ¡ç®¡ç†å±‚æ–‡ä»¶ (4ä¸ª)**

| æ–‡ä»¶ | æ ¸å¿ƒèŒè´£ | ç®¡ç†çš„æœåŠ¡æ•° | å…³é”®ç‰¹æ€§ |
|------|----------|--------------|----------|
| `services/service-bus.js` | ä¾èµ–æ³¨å…¥å®¹å™¨ï¼Œå¾ªç¯ä¾èµ–è§£å†³ | 20+ | æ‡’åŠ è½½ï¼Œç”Ÿå‘½å‘¨æœŸç®¡ç† |
| `services/service-registry.js` | æœåŠ¡å®šä¹‰æ³¨å†Œï¼Œä¾èµ–é…ç½® | 20+ | æ‰¹é‡åˆå§‹åŒ–ï¼Œäº¤å‰ä¾èµ–å¤„ç† |
| `services/response-service.js` | ç»Ÿä¸€å“åº”æ ¼å¼ï¼Œé”™è¯¯å¤„ç† | N/A | success(), error() æ–¹æ³• |
| `services/config-service.js` | é…ç½®æ–‡ä»¶ç®¡ç†ï¼Œç¯å¢ƒå˜é‡å¤„ç† | 5ä¸ªé…ç½®æ–‡ä»¶ | çƒ­æ›´æ–°æ”¯æŒ |

### ğŸ§  **æ ¸å¿ƒä¸šåŠ¡æœåŠ¡å±‚æ–‡ä»¶ (6ä¸ª)**

| æ–‡ä»¶ | æ ¸å¿ƒç®—æ³• | Tokenå¤„ç†èƒ½åŠ› | ç‰¹æ®ŠåŠŸèƒ½ |
|------|----------|---------------|----------|
| `services/ai-todo-manager.js` | æ™ºèƒ½ä»»åŠ¡ç”Ÿæˆç®—æ³• | æ”¯æŒ | ä¼˜å…ˆçº§æ’åº |
| `services/complete-task-monitor.js` | çŠ¶æ€è·Ÿè¸ªç®—æ³• | æ”¯æŒ | å®æ—¶ç›‘æ§ |
| `services/project-overview-generator.js` | é¡¹ç›®æ‰«æç®—æ³• | é«˜çº§ | å…ƒæ•°æ®æå– |
| `services/file-query-service.js` | æ™ºèƒ½æ£€ç´¢ç®—æ³• | é«˜çº§ | è¯­ä¹‰æœç´¢ |
| `services/smart-content-trimmer.js` | Tokenä¼˜åŒ–ç®—æ³• | ä¸“ä¸šçº§ | å†…å®¹æ™ºèƒ½å‹ç¼© |
| `services/language-intelligence-service.js` | è¯­è¨€æ™ºèƒ½ç®—æ³• | ä¸“ä¸šçº§ | ä¸Šä¸‹æ–‡åˆ†æ |

### ğŸ“‹ **æ¨¡æ¿ç³»ç»Ÿæ–‡ä»¶ (3ä¸ª)**

| æ–‡ä»¶ | æ¨¡æ¿ç­–ç•¥æ•° | ç¼“å­˜æœºåˆ¶ | è¯­è¨€æ”¯æŒ |
|------|-----------|----------|----------|
| `services/unified/master-template-service.js` | 4ç§ | MD5+TTL | 6ç§ä¸»æµè¯­è¨€ |
| `services/unified/template-config-manager.js` | N/A | é…ç½®ç¼“å­˜ | é€šç”¨é…ç½® |
| `services/unified/mode-template-service.js` | 3ç§ | æ¨¡å¼ç¼“å­˜ | å·¥ä½œæ¨¡å¼ç‰¹åŒ– |

### ğŸŒ **è¯­è¨€å¤„ç†æ–‡ä»¶ (2ä¸ª)**

| æ–‡ä»¶ | æ£€æµ‹ç®—æ³• | æ”¯æŒè¯­è¨€æ•° | ç‰¹æ®Šèƒ½åŠ› |
|------|----------|-----------|----------|
| `language/detector.js` | å¤šç‰¹å¾èåˆç®—æ³• | 6ç§ä¸»æµè¯­è¨€ | æ¡†æ¶ç‰¹å¾è¯†åˆ« |
| `language/prompt-intelligence.js` | ä¸Šä¸‹æ–‡ç”Ÿæˆç®—æ³• | 6ç§ | æ™ºèƒ½å»ºè®®ç”Ÿæˆ |

### ğŸ”¬ **æ–‡ä»¶åˆ†ææ¨¡å—æ–‡ä»¶ (5ä¸ª)**

| æ–‡ä»¶ | åˆ†æèƒ½åŠ› | Tokené˜ˆå€¼ | æ‰¹æ¬¡ç­–ç•¥ |
|------|----------|-----------|----------|
| `file-analysis/FileAnalysisModule.js` | ç³»ç»Ÿå¤§è„‘ | 15K/20K | 3ç§ç­–ç•¥åè°ƒ |
| `file-analysis/token-analysis/PreciseTokenCalculator.js` | ç²¾ç¡®Tokenè®¡ç®— | ä»»æ„ | å¤šè¯­è¨€ä¼°ç®— |
| `file-analysis/token-analysis/FunctionBoundaryDetector.js` | å‡½æ•°è¾¹ç•Œæ£€æµ‹ | ä»»æ„ | æ™ºèƒ½åˆ†å‰² |
| `file-analysis/batch-strategies/CombinedFileBatchStrategy.js` | å°æ–‡ä»¶ç»„åˆ | <15K | æ•ˆç‡ä¼˜åŒ– |
| `file-analysis/batch-strategies/SingleFileBatchStrategy.js` | å•æ–‡ä»¶å¤„ç† | 15K-20K | è´¨é‡ä¿è¯ |
| `file-analysis/batch-strategies/LargeFileMultiBatchStrategy.js` | å¤§æ–‡ä»¶åˆ†å‰² | >20K | ä¸Šä¸‹æ–‡ä¿æŠ¤ |

### ğŸ“‹ **ä»»åŠ¡ç®¡ç†æ¨¡å—æ–‡ä»¶ (7ä¸ª)**

| æ–‡ä»¶ | ç®¡ç†èŒƒå›´ | éªŒè¯ç­–ç•¥ | çŠ¶æ€æ•°é‡ |
|------|----------|----------|----------|
| `task-management/UnifiedTaskManager.js` | å…¨ç”Ÿå‘½å‘¨æœŸ | 4ç§ | 5ç§çŠ¶æ€ |
| `task-management/TaskStateManager.js` | çŠ¶æ€æŒä¹…åŒ– | N/A | çŠ¶æ€å†å² |
| `task-management/UnifiedTaskValidator.js` | ç»Ÿä¸€éªŒè¯ | 4ç§ç­–ç•¥ | å®Œæˆæ£€æŸ¥ |
| `task-management/validation-strategies/Step3FolderValidator.js` | æ–‡ä»¶å¤¹éªŒè¯ | æ–‡ä»¶å­˜åœ¨æ€§ | Step3ä¸“ç”¨ |
| `task-management/validation-strategies/Step4ModuleValidator.js` | æ¨¡å—éªŒè¯ | å®Œæ•´æ€§æ£€æŸ¥ | Step4ä¸“ç”¨ |
| `task-management/validation-strategies/Step5FixedFileValidator.js` | å›ºå®šæ–‡ä»¶éªŒè¯ | ä¾èµ–æ£€æŸ¥ | Step5ä¸“ç”¨ |
| `task-management/validation-strategies/Step6ArchitectureValidator.js` | æ¶æ„éªŒè¯ | æ–‡æ¡£æ£€æŸ¥ | Step6ä¸“ç”¨ |

### âš™ï¸ **é…ç½®æ–‡ä»¶ (5ä¸ª)**

| é…ç½®æ–‡ä»¶ | é…ç½®é¡¹æ•° | ä¸»è¦ä½œç”¨ | çƒ­æ›´æ–°æ”¯æŒ |
|----------|----------|----------|------------|
| `config/mcp.config.json` | 10+ | MCPåè®®å‚æ•° | âœ… |
| `config/modes.config.json` | 15+ | å·¥ä½œæ¨¡å¼å‚æ•° | âœ… |
| `config/template-system.config.json` | 8+ | æ¨¡æ¿ç³»ç»Ÿè®¾ç½® | âœ… |
| `config/templates.config.json` | 50+ | æ¨¡æ¿æ˜ å°„å…³ç³» | âœ… |
| `config/workflows.config.json` | 20+ | å·¥ä½œæµæ­¥éª¤å®šä¹‰ | âœ… |

## ğŸ”„ å…³é”®è°ƒç”¨è·¯å¾„è¯¦ç»†åˆ†æ

### 1. **MCPå·¥å…·è°ƒç”¨å®Œæ•´è·¯å¾„**

```
ğŸ¯ workflow_guide
Client Request â†’ index.js:437 (CallToolRequestSchema) 
â†’ å‚æ•°è§£æ â†’ å·¥ä½œæµæŒ‡å¼•ç”Ÿæˆ â†’ JSONå“åº”

ğŸš€ init_step1_project_analysis  
Client Request â†’ index.js:437 â†’ serviceBus.get('projectOverviewGenerator')
â†’ ProjectOverviewGenerator.generateOverview() â†’ LanguageDetector.detect()
â†’ æ–‡ä»¶æ‰«æ â†’ å…ƒæ•°æ®æå– â†’ mg_kiro/step1-result.json

ğŸ§  init_step2_file_analysis
Client Request â†’ index.js:437 â†’ serviceBus.get('fileAnalysisModule')  
â†’ FileAnalysisModule.analyzeProject() â†’ PreciseTokenCalculator.calculateTokens()
â†’ æ‰¹æ¬¡ç­–ç•¥é€‰æ‹© â†’ ä»»åŠ¡å®šä¹‰ç”Ÿæˆ â†’ mg_kiro/step2-result.json

ğŸ“„ init_step3_get_next_task
Client Request â†’ index.js:437 â†’ serviceBus.get('unifiedTaskManager')
â†’ UnifiedTaskManager.getNextTask() â†’ TaskStateManager.getState()
â†’ ä»»åŠ¡é˜Ÿåˆ—è·å– â†’ è®¾ç½®å½“å‰ä»»åŠ¡ä¸Šä¸‹æ–‡ â†’ è¿”å›ä»»åŠ¡ä¿¡æ¯
```

### 2. **Expressè·¯ç”±è°ƒç”¨å®Œæ•´è·¯å¾„**

```
ğŸ’“ å¥åº·æ£€æŸ¥è·¯å¾„
GET /health â†’ routes/index.js:createAppRoutes() â†’ system/health.js:createHealthRoutes()
â†’ ServiceBusçŠ¶æ€æ£€æŸ¥ â†’ response-service.success() â†’ JSONå“åº”

ğŸ“ æ¨¡æ¿ç®¡ç†è·¯å¾„  
GET /prompts/* â†’ routes/index.js â†’ system/prompts.js â†’ MasterTemplateService.getTemplate()
â†’ æ¨¡æ¿ç­–ç•¥é€‰æ‹© â†’ LanguageIntelligenceServiceæ™ºèƒ½å¤„ç† â†’ æ¨¡æ¿å†…å®¹è¿”å›

ğŸš€ InitæœåŠ¡è·¯å¾„
POST /init/* â†’ routes/index.js â†’ init/claude-code-init.js â†’ ç›¸åº”æœåŠ¡è°ƒç”¨
â†’ ä¸šåŠ¡é€»è¾‘å¤„ç† â†’ response-serviceæ ‡å‡†åŒ– â†’ JSONå“åº”
```

### 3. **æœåŠ¡åˆå§‹åŒ–å®Œæ•´è·¯å¾„**  

```
ç³»ç»Ÿå¯åŠ¨ â†’ index.js:startServer() â†’ initializeServices(CONFIG_DIR)
â†’ service-registry.js:registerServices() â†’ æ³¨å†Œ20+ä¸ªæœåŠ¡åˆ°ServiceBus
â†’ serviceBus.initializeAll() â†’ æŒ‰ä¾èµ–é¡ºåºåˆå§‹åŒ–æ‰€æœ‰æœåŠ¡
â†’ è®¾ç½®å¾ªç¯ä¾èµ–å…³ç³» â†’ äº¤å‰ä¾èµ–æ³¨å…¥ â†’ è¿”å›å®Œæ•´çš„ServiceBus
```

### 4. **æ–‡ä»¶åˆ†æå¤„ç†å®Œæ•´è·¯å¾„**

```
æ–‡ä»¶åˆ†æè¯·æ±‚ â†’ FileAnalysisModule.analyzeProject() 
â†’ _analyzeFileTokens() â†’ PreciseTokenCalculatorç²¾ç¡®è®¡ç®—
â†’ _categorizeFiles() â†’ æŒ‰Tokenæ•°é‡åˆ†ç±»(å°/ä¸­/å¤§æ–‡ä»¶)
â†’ _generateBatchPlans() â†’ 3ç§æ‰¹æ¬¡ç­–ç•¥å¹¶è¡Œå¤„ç†
â†’ _createTaskDefinitions() â†’ æ ‡å‡†åŒ–ä»»åŠ¡å®šä¹‰
â†’ _storeTaskDefinitions() â†’ ä»»åŠ¡å­˜å‚¨ â†’ è¿”å›åˆ†æç»“æœ
```

## ğŸ§© å¾ªç¯ä¾èµ–è§£å†³æ–¹æ¡ˆ

### **ä¸»è¦å¾ªç¯ä¾èµ–å¯¹**
1. **LanguageIntelligenceService â†” MasterTemplateService**
   - **è§£å†³æ–¹æ¡ˆ**: ServiceBuså»¶è¿Ÿæ³¨å…¥
   - **æ³¨å…¥æ—¶æœº**: æ‰€æœ‰æœåŠ¡åˆå§‹åŒ–å®Œæˆå
   - **å®ç°ä»£ç **: `service-registry.js:126-140`

2. **UnifiedTaskValidator â†” UnifiedTaskManager**  
   - **è§£å†³æ–¹æ¡ˆ**: ä¾èµ–æ³¨å…¥æ–¹æ³•
   - **æ³¨å…¥æ—¶æœº**: æ„é€ å‡½æ•°åè°ƒç”¨`injectDependencies()`
   - **å®ç°ä»£ç **: `service-registry.js:147-160`

### **ä¾èµ–è§£å†³é¡ºåº**
```
Phase 1: åŸºç¡€æœåŠ¡æ³¨å†Œ (æ— å¾ªç¯ä¾èµ–)
â”œâ”€â”€ ConfigService, LanguageDetector, TokenCalculator...

Phase 2: æ ¸å¿ƒæœåŠ¡åˆå§‹åŒ– (æœ‰å¾ªç¯ä¾èµ–)  
â”œâ”€â”€ LanguageIntelligenceService, MasterTemplateService...

Phase 3: å¾ªç¯ä¾èµ–è§£å†³
â”œâ”€â”€ äº¤å‰ä¾èµ–æ³¨å…¥
â”œâ”€â”€ ç›¸äº’ä¾èµ–å…³ç³»è®¾ç½®
â””â”€â”€ ä¾èµ–å…³ç³»éªŒè¯

Phase 4: é«˜çº§æœåŠ¡åˆå§‹åŒ–
â”œâ”€â”€ FileAnalysisModule, UnifiedTaskManager...
â””â”€â”€ å®Œæ•´ç³»ç»Ÿå°±ç»ª
```

## ğŸ“Š æ¶æ„ç»Ÿè®¡æ•°æ®

| ç±»åˆ« | æ–‡ä»¶æ•°é‡ | ä»£ç è¡Œæ•°(ä¼°ç®—) | Tokenå¤„ç†èƒ½åŠ› |
|------|----------|----------------|---------------|
| **å…¥å£å±‚** | 1 | 1200+ | é«˜çº§ |
| **è·¯ç”±å±‚** | 10 | 2500+ | ä¸­çº§ |
| **æœåŠ¡ç®¡ç†** | 4 | 800+ | é«˜çº§ |
| **æ ¸å¿ƒæœåŠ¡** | 6 | 1500+ | ä¸“ä¸šçº§ |
| **æ¨¡æ¿ç³»ç»Ÿ** | 3 | 1800+ | ä¸“ä¸šçº§ |
| **è¯­è¨€å¤„ç†** | 2 | 600+ | é«˜çº§ |
| **æ–‡ä»¶åˆ†æ** | 5 | 2000+ | ä¸“ä¸šçº§ |
| **ä»»åŠ¡ç®¡ç†** | 7 | 1500+ | é«˜çº§ |
| **é…ç½®æ–‡ä»¶** | 5 | N/A | N/A |
| **å·¥å…·è„šæœ¬** | 1 | 50+ | åŸºç¡€ |
| **æ€»è®¡** | **44** | **12000+** | **ä¼ä¸šçº§** |

## ğŸ¯ æ¶æ„äº®ç‚¹åˆ†æ

### **ğŸ† è®¾è®¡ä¼˜åŠ¿**
1. **æ¨¡å—åŒ–ç¨‹åº¦**: é«˜åº¦æ¨¡å—åŒ–ï¼Œ44ä¸ªæ–‡ä»¶èŒè´£æ¸…æ™°
2. **ä¾èµ–ç®¡ç†**: ServiceBusç»Ÿä¸€ç®¡ç†ï¼Œè§£å†³å¤æ‚å¾ªç¯ä¾èµ–  
3. **æ‰©å±•æ€§**: æ’ä»¶å¼æœåŠ¡æ³¨å†Œï¼Œæ˜“äºæ·»åŠ æ–°åŠŸèƒ½
4. **æ™ºèƒ½åŒ–**: 4ç§å¤„ç†ç­–ç•¥ï¼ŒTokençº§åˆ«ä¼˜åŒ–
5. **å®¹é”™æ€§**: å®Œå–„çš„é”™è¯¯å¤„ç†å’ŒçŠ¶æ€æ¢å¤

### **ğŸ”§ æŠ€æœ¯ç‰¹è‰²**
- **ä¸‰åˆä¸€æœåŠ¡å™¨**: MCP + Express + WebSocket
- **æ™ºèƒ½æ‰¹æ¬¡å¤„ç†**: åŸºäºTokenæ•°é‡çš„ä¸‰ç§ç­–ç•¥
- **å¾ªç¯ä¾èµ–è§£å†³**: ServiceBus + å»¶è¿Ÿæ³¨å…¥æ–¹æ¡ˆ
- **å¤šæ–‡æ¡£æ¨¡æ¿**: æ”¯æŒå¤æ‚çš„Initå·¥ä½œæµ
- **çŠ¶æ€æŒä¹…åŒ–**: å®Œæ•´çš„ä»»åŠ¡ç”Ÿå‘½å‘¨æœŸç®¡ç†

### **ğŸ“ˆ æ€§èƒ½ä¼˜åŒ–**
- **æ‡’åŠ è½½**: æœåŠ¡æŒ‰éœ€åˆå§‹åŒ–
- **å¤šå±‚ç¼“å­˜**: æ¨¡æ¿ç¼“å­˜ + é…ç½®ç¼“å­˜ + Tokenç¼“å­˜  
- **æ™ºèƒ½åˆ†å‰²**: å¤§æ–‡ä»¶è¾¹ç•Œæ£€æµ‹ï¼Œä¸Šä¸‹æ–‡ä¿æŠ¤
- **å¹¶è¡Œå¤„ç†**: æ‰¹æ¬¡ç­–ç•¥å¹¶è¡Œæ‰§è¡Œ
- **å†…å­˜ç®¡ç†**: LRUç¼“å­˜ + å®šæœŸæ¸…ç†

è¿™ä¸ªè¶…è¯¦ç»†æ¶æ„å›¾ç²¾ç¡®å±•ç¤ºäº†mg_kiro MCPæœåŠ¡å™¨çš„æ¯ä¸ªæ–‡ä»¶èŒè´£ã€ä¾èµ–å…³ç³»å’Œè°ƒç”¨è·¯å¾„ï¼Œä¸ºæ·±åº¦ç†è§£å’Œç»´æŠ¤é¡¹ç›®æä¾›äº†å®Œæ•´çš„æŠ€æœ¯è“å›¾ã€‚

---

*æ¶æ„åˆ†ææ—¶é—´: 2024å¹´åº¦*  
*åˆ†æç²¾åº¦: æ–‡ä»¶çº§åˆ«*  
*åˆ†æå·¥å…·: Claude Code + æ·±åº¦ä»£ç åˆ†æ*